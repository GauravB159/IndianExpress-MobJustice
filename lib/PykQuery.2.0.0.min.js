function standardDeviation(a,b){var c=average(a),d=a.map(function(a){var b=a-c,d=b*b;return d}),e=b?average(d)-1:average(d),f=Math.sqrt(e);return f}function variance(a,b){var c=average(a),d=a.map(function(a){var b=a-c,d=b*b;return d}),e=b?average(d)-1:average(d);return e}function average(a){var b=a.reduce(function(a,b){return a+b},0),c=b/a.length;return c}function generateFunction(a){var b,c,d,e,f,g,h,i=a.length,j="",k="";for(h=0;h<i;h++)b=a[h],c=b.column_name,d=b.sort_type,e="asc"===d?"<":">",f=">"===e?"<":">",k+=" var sort_type = '"+d+"';",k+=" if(d1['"+c+"'] !== d2['"+c+"']) {",k+="if (sort_type === 'asc') return (d1['"+c+"'] < d2['"+c+"'])?-1:1;",k+="else return (d2['"+c+"'] < d1['"+c+"'])?-1:1;",k+=" }",k+=" else { ",j+="}";return k+=j,g=new Function("d1","d2",k)}function error(a){console.error("%c[Error - PykQuery] ","color: red;font-weight:bold;font-size:14px",a)}function warning(a){console.warn("%c[Warning - PykQuery] ","color: #F8C325;font-weight:bold;font-size:14px",a)}function Utility(a){return new ArrayWrapper(a)}function List(){}function MoveNext(a){this.list=a,this.index=-1}function MappedList(a,b){this.parent=a,this.mapFn=b}function FilteredList(a,b){this.parent=a,this.filterFn=b}function FilteringMoveNext(a,b){this.movenext=a.getmovenext(),this.filterFn=b,this.index=0}function ReversedList(a){this.parent=a}function ReversedMoveNext(a){this.list=a}function TakeList(a,b){this.parent=a,this.count=b}function SortedList(a,b){this.parent=a,this.sortFn=b}function InitialList(a,b){this.parent=a,this.count="number"==typeof b?b:1}function DropList(a,b){this.parent=a,this.count="number"==typeof b?b:1}function GroupedList(a,b,c){this.parent=a,this.keyFn=b,this.valFn=c}function IndexedList(a,b,c){this.parent=a,this.keyFn=b,this.valFn=c}function CountedList(a,b){this.parent=a,this.keyFn=b}function UniqueList(a,b){this.parent=a,this.keyFn=b}function FlattenedList(a){this.parent=a}function ChunkedList(a,b){this.parent=a,this.chunkSize=b}function ChunkedMoveNext(a,b){this.movenext=a.getmovenext(),this.size=b}function SimpleIntersectionList(a,b){this.parent=a,this.array=b,this.each=getEachForIntersection(b)}function getEachForIntersection(a){return a.length<40?SimpleIntersectionList.prototype.eachArrayCache:SimpleIntersectionList.prototype.eachMemoizerCache}function ArrayLikeList(){}function IndexedMoveNext(a){this.list=a,this.index=-1}function IndexedFilteredList(a,b){this.parent=a,this.filterFn=b}function IndexedReversedList(a){this.parent=a}function IndexedTakeList(a,b){this.parent=a,this.count=b}function IndexedDropList(a,b){this.parent=a,this.count="number"==typeof b?b:1}function IndexedConcatenatedList(a,b){this.parent=a,this.other=b}function IndexedUniqueList(a,b){this.parent=a,this.each=getEachForParent(a),this.keyFn=b}function getEachForParent(a){return a.length()<100?IndexedUniqueList.prototype.eachArrayCache:UniqueList.prototype.each}function ArrayWrapper(a){this.source=a}function MappedArrayWrapper(a,b){this.parent=a,this.mapFn=b}function FilteredArrayWrapper(a,b){this.parent=a,this.filterFn=b}function UniqueArrayWrapper(a,b){this.parent=a,this.each=getEachForSource(a.source),this.keyFn=b}function arrayContainsBefore(a,b,c,d){var e=-1;if(d){for(d=createCallback(d);++e<c;)if(d(a[e])===d(b))return!0}else for(;++e<c;)if(a[e]===b)return!0;return!1}function getEachForSource(a){return a.length<40?UniqueArrayWrapper.prototype.eachNoCache:a.length<100?UniqueArrayWrapper.prototype.eachArrayCache:UniqueArrayWrapper.prototype.eachSetCache}function ConcatArrayWrapper(a,b){this.parent=a,this.other=b}function ObjectLikeList(){}function FilteredObjectLikeList(a,b){this.parent=a,this.filterFn=b}function AsyncList(a,b){if(a instanceof AsyncList)throw new Error("Sequence is already asynchronous!");this.parent=a,this.interval=b,this.onNextCallback=getOnNextCallback(b),this.cancelCallback=getCancelCallback(b)}function AsyncHandle(a){this.resolveListeners=[],this.rejectListeners=[],this.state=PENDING,this.cancelFn=a}function getOnNextCallback(a){return"undefined"==typeof a&&"function"==typeof setImmediate?setImmediate:(a=a||0,function(b){return setTimeout(b,a)})}function getCancelCallback(a){return"undefined"==typeof a&&"function"==typeof clearImmediate?clearImmediate:clearTimeout}function transform(a,b){return b instanceof AsyncHandle?b.then(function(){a(b)}):a(b)}function createCallback(a,b){switch(typeof a){case"function":return a;case"string":return function(b){return b[a]};case"object":return function(b){return Utility(a).all(function(a,c){return b[c]===a})};case"undefined":return b?function(){return b}:Utility.identity;default:throw new Error("Don't know how to make a callback from a "+typeof a+"!")}}function createComparator(a,b){return a?(a=createCallback(a),function(b,c){return compare(a(b),a(c))}):compare}function reverseArguments(a){return function(b,c){return a(c,b)}}function compare(a,b){return a===b?0:a>b?1:-1}function forEach(a,b){for(var c=-1,d=a.length;++c<d;)if(b(a[c],c)===!1)return!1;return!0}function getFirst(a){var b;return a.each(function(a){return b=a,!1}),b}function arrayContains(a,b){var c=-1,d=a.length;if(b!==b){for(;++c<d;)if(a[c]!==a[c])return!0;return!1}for(;++c<d;)if(a[c]===b)return!0;return!1}function Queue(a){this.contents=new Array(a),this.start=0,this.count=0}function Set(){this.table={},this.objects=[]}function UniqueMemoizer(a){this.iterator=a,this.set=new Set,this.memo=[],this.currentValue=void 0}var PykQuery={},pykQuery={};pykQuery.nested_where_mode=!1,pykQuery.temp_where_params={},pykQuery.nested_having_mode=!1,pykQuery.temp_having_params={},pykQuery.push_to=[],pykQuery.gql_loaded=!1,pykQuery.table={},pykQuery.query={},PykQuery.table={name:"",raw_data:"",adapter:{}},PykQuery.node={div_id:"",raw_data:"",final_data:"",dim:[{name:"*",alias:"*"},{name:"quantity",alias:"QTY"}],met:[{name:"",aggr:"",alias:""},{name:"",aggr:"",alias:""}],table:[{name:"",alias:"",join_type:"",condition:[{conjunction:"",column_name:"",condition:"",value:""},{conjunction:"",column_name:[{conjunction:"",column_name:"",condition:"",value:""}],condition:"nest",value:""}]},{name:"",alias:"",join_type:"",condition:[]}],where:[{conjunction:"",column_name:"",condition:"",value:""},{conjunction:"",column_name:[{conjunction:"",column_name:"",condition:"",value:""}],condition:"nest",value:""}],groupby:["column_name"],having:[{conjunction:"",group_name:"",condition:"",value:""},{conjunction:"",group_name:[{conjunction:"",group_name:"",condition:"",value:""}],condition:"nest",value:""}],sort_by:[{column_name:"",order:""}],limit:"",offset:"",impacts:"",impactedby:"",union:[{}],unionAll:[{}],intersection:[{}],distinct:!1},pykQuery.dataConnector={},pykQuery.dataConnector.testConnectionUrl="http://localhost:3000/testConnection",pykQuery.dataConnector.queryUrl="http://localhost:3000/query",pykQuery.escapeLiterals={mysql:["`","`"],postgresql:['"','"'],mssql:["[","]"],inbrowser:['"','"']},PykQuery.mediator=function(){var a=function(a,b){return PykQuery.mediator.channels[a]||(PykQuery.mediator.channels[a]={}),PykQuery.mediator.channels[a]={context:this,callback:b},this},b=function(a){if(!PykQuery.mediator.channels[a])return!1;var b=Array.prototype.slice.call(arguments,1),c=PykQuery.mediator.channels[a];return c.callback.apply(c.context,b)},c=function(a){delete PykQuery.mediator.channels[a]};return{channels:{},publish:b,subscribe:a,unsubscribe:c}}();var gql={};gql.tableAction=function(a){for(var b=pykQuery.table[a].rows_to_be_modified.length,c=0,d="",e=pykQuery.table[a],f={};c<b;c++)switch(f=e.rows_to_be_modified[c],d=f.action){case"insert":gql.tableInsert(a,f);break;case"update":gql.tableUpdate(a,f);break;case"delete":gql.tableDelete(a,f)}e.rows_to_be_modified=[]},gql.getData=function(a,b,c,d){var e="",f="",g=a,h=b,i=setInterval(function(){if(!pykQuery.gql_current_table){clearInterval(i),e=gql.createGqlString(g,h),f=pykQuery.table[g].data.key;var a="https://docs.google.com/spreadsheets/d/"+f+"/gviz/tq?gid="+pykQuery.table[g].data.sheetId+"&tq="+encodeURIComponent(e),b=new google.visualization.Query(a);b.send(function(a){var b;a.isError()?(error("Error in query: "+a.getMessage()+" "+a.getDetailedMessage()),d(a)):(b=gql.transformData(a),c(b))})}},100)},gql.setHeaders=function(a){var b=pykQuery.gql_current_table;pykQuery.table[b].column_mapping=a.J.Sf,gql.setColumns(pykQuery.table[b].column_mapping,b),delete pykQuery.gql_current_table},gql.setColumns=function(a,b){var c;pykQuery.table[b].columns=a.map(function(a){return c=a.label})},gql.transformData=function(a){var b,c,d,e,f,g,h,i,j=(a.length,[]);for(d=a.J.Tf,e=d.length,f=a.J.Sf,g=f.length,b=0;b<e;b++){for(h=[],c=0;c<g;c++)h[c]={},h[c].key=f[c].label,h[c].value=d[b].c[c].f||d[b].c[c].v;for(i={},c=0;c<g;c++)i[h[c].key]=h[c].value;j.push(i)}return j},gql.createGqlString=function(a,b){var c="",d=pykQuery.query[b].config;return c+=gql.selectString(d,a),d.where&&(c+=" where "+gql.whereString(d.where,a)),d.groupby&&(c+=gql.groupbyString(d,a)),d.order_by&&(c+=gql.orderbyString(d,a)),d.limit&&(c+=gql.limitString(d)),d.offset&&(c+=gql.offsetString(d)),c+=gql.aliasString(d,a)},gql.orderbyString=function(a,b){var c,d=a.order_by,e=d.length,f=" order by ";for(c=0;c<e;c++)f+=gql.mapColumnToGqlColumn(d[c].column_name.toLowerCase(),b)+" ",f+=d[c].sort_type,c<e-1&&(f+=",");return f},gql.limitString=function(a){return" limit "+a.limit},gql.offsetString=function(a){return" offset "+a.offset},gql.selectString=function(a,b){var c,d,e,f,g,h=a.dim,i=h?h.length:0,j=a.met,k=j?j.length:0;if(f="Select ","*"===h[0].name)f+=" * ";else{for(c=0;c<i;c++)d=h[c],f+=gql.mapColumnToGqlColumn(d.name.toLowerCase(),b),f+=",";for(c=0;c<k;c++)e=j[c],g=e.name,f+=e.aggr+"("+gql.mapColumnToGqlColumn(g,b)+")",f+=","}return f=f.replace(/,\s*$/,"")},gql.groupbyString=function(a,b){var c,d=a.groupby,e=a.groupby.length,f="";for(e>0&&(f+=" group by "),c=0;c<e;c++)f+=gql.mapColumnToGqlColumn(d[c],b)+",";return f=f.replace(/,\s*$/,"")},gql.whereString=function(a,b){var c,d,e=a.length,f="";for(c=0;c<e;c++){switch(a[c].conjunction){case"and":f+=" and ";break;case"or":f+=" or "}if(void 0!==a[c].column_name&&validateDataType(a[c].column_name,"array"))f+="( "+gql.whereString(a[c].column_name,b)+" )";else switch(d=gql.mapColumnToGqlColumn(a[c].column_name.toLowerCase(),b),a[c].condition){case"between":f+="("+d+">="+a[c].value[0]+" and "+d+"<="+a[c].value[1]+")";break;case"notBetween":f+="("+d+"<"+a[c].value[0]+" or "+d+">"+a[c].value[1]+")";break;case"equal":f+=d+"="+a[c].value;break;case"notEqual":f+=d+"!="+a[c].value;break;case"greaterThan":f+=d+">"+a[c].value;break;case"greaterThanEqual":f+=d+">="+a[c].value;break;case"lessThan":f+=d+"<"+a[c].value;break;case"lessThanEqual":f+=d+"<="+a[c].value;break;case"like":f+=d+" like "+a[c].value;break;case"in":for(f+="("+d+" = "+a[c].value[0],j=1;j<a[c].value.length;j++)f+=" or "+filter_obj.column_name+" = "+filter_obj.value[j];f+=")";break;case"notIn":for(f+="("+d+" != "+a[c].value[0],j=1;j<filter_obj.value.length;j++)f+=" and "+filter_obj.column_name+" != "+filter_obj.value[j];break;case"isNull":f+=d+" is null";break;case"isNotNull":f+=d+" is not null"}}return f},gql.mapColumnToGqlColumn=function(a,b){var c,d=pykQuery.table[b].column_mapping.length,e=pykQuery.table[b].column_mapping;for(c=0;c<d;c++)if(e[c].label.toLowerCase()===a.toLowerCase())return e[c].id},gql.aliasString=function(a,b){var c,d,e,f=a.dim,g=f?f.length:0,h=a.met,i=h?h.length:0,j="";if("*"===f[0].name)j+="";else{for(c=0;c<g;c++)d=f[c],d.alias&&d.alias!==d.name&&(j+=gql.mapColumnToGqlColumn(d.name.toLowerCase(),b)+" '"+d.alias+"'",j+=",");for(c=0;c<i;c++)e=h[c],e.alias&&e.alias!==e.aggr+" "+e.name&&(j+=e.aggr+"("+gql.mapColumnToGqlColumn(e.name,b)+") '"+e.alias+"'",j+=",")}return j=j.replace(/,\s*$/,""),j&&(j=" label "+j),j},gql.tableInsert=function(a,b){var c,d,e,f,g;e=pykQuery.table[a].data.worksheetid,f=pykQuery.table[a].data.key,c="https://spreadsheets.google.com/feeds/list/",c+=f+"/",c+=e+"/",c+="private/full",d=pykQuery.userAccessDetails.token_type+" "+pykQuery.userAccessDetails.access_token,g=gql.generateEntryRow(b),sendHTTPRequest({action:"POST",url:c,headers:{"Content-type":"application/atom+xml","GData-Version":"3.0",Authorization:d},success:function(a){console.log("data success",a)},error:function(a){console.log("data error",a)},request:g})},gql.tableRowUpdate=function(a,b,c){if(a.feed.entry&&a.feed.entry.length>0){var d,e,f,g,h,i,j,k,l,m,n,o="",p=a.feed.entry.length,q=a.feed.entry;pykQuery.userAccessDetails.token_type+" "+pykQuery.userAccessDetails.access_token;for(d=0;d<p;d++){for(e=q[d],f=e.link[1].href,o="",o+="<entry xmlns='http://www.w3.org/2005/Atom' xmlns:gsx='http://schemas.google.com/spreadsheets/2006/extended'>",o+="<id>",o+=e.id.$t,o+="</id>",o+="<updated>",o+=e.updated.$t,o+="</updated>",o+='<category scheme = "',o+=e.category[0].scheme,o+='" term = "',o+=e.category[0].term,o+='"/>',o+="<title ",o+=' type = "',o+=e.title.type,o+='"',o+=">",o+=e.title.$t,o+="</title>",o+="<content ",o+=' type = "',o+=e.content.type,o+='">',o+=e.content.$t,o+="</content>",o+='<link rel="',o+=e.link[0].rel,o+='" ',o+=' type = "',o+=e.link[0].type,o+='" ',o+=' href = "',o+=e.link[0].href,o+='" />',o+='<link rel="',o+=e.link[1].rel,o+='" ',o+=' type = "',o+=e.link[1].type,o+='" ',o+=' href = "',o+=e.link[1].href,o+='" />',g=Object.keys(e),i=0;i<g.length;i++)if(g[i].indexOf("gsx$")>-1){for(h=g[i].split("$")[1],k=Object.keys(c.update),l=k.length,n=!1,j=0;j<l;j++)m=k[j].toLowerCase(),h===m&&(n=!0,o+="<gsx:"+h+">",o+=c.update[k[j]],o+="</gsx:"+h+">");n||(n=!0,o+="<gsx:"+h+">",o+=e[g[i]].$t,o+="</gsx:"+h+">")}o+="</entry>",gql.sendUpdateUrlRequest(f,"Bearer "+pykQuery.userAccessDetails.access_token,o)}c.update=[]}else warning("no rows to be updated")},gql.sendUpdateUrlRequest=function(a,b,c){sendHTTPRequest({action:"PUT",url:a,headers:{"Content-type":"application/atom+xml",Authorization:b},success:function(a){},error:function(a){console.log("data error",a)},request:c})},gql.tableUpdate=function(a,b){var c,d,e,f,g;pykQuery.table_name_obj_update=a,pykQuery.row_data_obj_update=b,e=pykQuery.table.table_name.data.key,f=pykQuery.table[a].data.worksheetid,c="https://spreadsheets.google.com/feeds/list/",c+=e+"/",c+=f+"/",c+="private/full?alt=json",pykQuery.table[a].rows_to_be_filtered&&pykQuery.table[a].rows_to_be_filtered.length>0&&(d=gql.getFilterString(pykQuery.table[a].rows_to_be_filtered),c+=d),g=pykQuery.userAccessDetails.token_type+" "+pykQuery.userAccessDetails.access_token,sendHTTPRequest({action:"GET",url:c,headers:{"Content-type":"application/atom+xml",Authorization:g},success:function(a){gql.tableRowUpdate(JSON.parse(a),pykQuery.table_name_obj_update,pykQuery.row_data_obj_update)},error:function(a){error("data error",a)}})},gql.tableDelete=function(a,b){var c,d,e,f,g;pykQuery.table_name_obj_delete=a,pykQuery.row_data_obj_delete=b,e=pykQuery.table.table_name.data.key,f=pykQuery.table[a].data.worksheetid,c="https://spreadsheets.google.com/feeds/list/",c+=e+"/",c+=f+"/",c+="private/full?alt=json",pykQuery.table[a].row_data&&pykQuery.table[a].row_data.data>0&&(d=gql.getFilterString(pykQuery.table[a].row_data.data),c+=d),g=pykQuery.userAccessDetails.token_type+" "+pykQuery.userAccessDetails.access_token,sendHTTPRequest({action:"GET",url:c,headers:{"Content-type":"application/atom+xml",Authorization:g},success:function(a){gql.tableRowDelete(JSON.parse(a),pykQuery.table_name_obj_delete,pykQuery.row_data_obj_delete),pykQuery.row_data_obj_delete={}},error:function(a){error("data error",a),pykQuery.row_data_obj_delete={}}})},gql.tableRowDelete=function(a,b,c){if(a.feed.entry&&a.feed.entry.length>0){var d,e,f,g,h=a.feed.entry.length,i=a.feed.entry;pykQuery.userAccessDetails.token_type+" "+pykQuery.userAccessDetails.access_token;for(d=0;d<h;d++)e=i[d],f=e.link[1].href,g=Object.keys(e),gql.sendDeleteUrlRequest(f,"Bearer "+pykQuery.userAccessDetails.access_token)}else warning("no rows to be deleted")},gql.sendDeleteUrlRequest=function(a,b){sendHTTPRequest({action:"DELETE",url:a,headers:{"Content-type":"application/atom+xml",Authorization:b},success:function(a){console.log("data success",a)},error:function(a){console.log("data error",a)}})},gql.getFilterString=function(a){var b,c,d,e,f,g="",h=a.length;if(h>0)for(b=0;b<h;b++)switch(d=a[b],g+=" "+a[b].conjunction+" ",valid_conditions=["between","notBetween","equal","notEqual","greaterThan","greaterThanEqual","lessThan","lessThanEqual","like","in","notIn","isNull","isNotNull"],c=d.condition,f=d.column_name.toLowerCase(),c){case"between":g+="("+f+">="+d.value[0]+" and "+f+"<="+d.value[1]+")";break;case"notBetween":g+="("+f+"<"+d.value[0]+" or "+f+">"+d.value[1]+")";break;case"equal":g+=f+"="+d.value;break;case"notEqual":g+=f+"!="+d.value;break;case"greaterThan":g+=f+">"+d.value;break;case"greaterThanEqual":g+=f+">="+d.value;break;case"lessThan":g+=f+"<"+d.value;break;case"lessThanEqual":g+=f+"<="+d.value;break;case"like":warning("The like query cannot be performed over google query language");break;case"in":for(g+="("+f+" = "+d.value[0],e=1;e<d.value.length;e++)g+=" or "+d.column_name+" = "+d.value[b];g+=")";break;case"notIn":for(g+=d.column_name+" != "+d.value[0],e=1;e<d.value.length;e++)g+=" and "+d.column_name+" != "+d.value[e];break;case"isNull":warning("The is null query cannot be performed over google query language");break;case"isNotNull":warning("The is not null query cannot be performed over google query language")}return""!==g.trim()&&(g="&sq="+g),g},gql.generateEntryRow=function(a){var b,c,d,e,f;for(b='<entry xmlns="http://www.w3.org/2005/Atom" xmlns:gsx="http://schemas.google.com/spreadsheets/2006/extended">',c=Object.keys(a.data),d=c.length,e=0;e<d;e++)f=c[e].toLowerCase(),b+="<gsx:"+f+">",b+=a.data[c[e]],b+="</gsx:"+f+">";return b+="</entry>"},gql.helper={},gql.helper.getSpreadSheetList=function(a,b,c,d){var e,f,g,h="https://spreadsheets.google.com/feeds/worksheets/"+a+"/private/full?alt=json",i=[];sendHTTPRequest({action:"GET",url:h,headers:{Authorization:"Bearer "+b},success:function(a){if(a){if(a=JSON.parse(a),a.feed)for(f=a.feed.entry,e=0;e<f.length;e++)g=f[e].link[2].href,g=g.substring(g.indexOf("gid=")+4),i.push({title:f[e].title.$t,gid:g});c(i)}},error:function(a){d(i)}})};var inbrowser={};inbrowser.getData=function(a,b){var c,d,e=Utility(pykQuery.table[a].data),f=pykQuery.query[b].config,g={type:"unionall",query:b},h=0,i=[];for(f.union_unionall_intersection=f.union_unionall_intersection||[],f.union_unionall_intersection.splice(0,0,g),c=f.union_unionall_intersection.length;h<c;){if(e=Utility(pykQuery.table[a].data),d=f.union_unionall_intersection[h].query,f.on&&(e=inbrowser.join(d)),(f.where||f.impact_filters)&&(e=inbrowser.where(d,e)),f.groupby&&(e=inbrowser.groupby(d,e)),(!f.groupby||!!f.aggregation&&f.aggregation.length>0)&&(e=inbrowser.select(d,e)),f.distinct&&(e=inbrowser.distinct(d,e)),f.order_by&&(e=inbrowser.orderBy(d,e)),f.offset&&(e=e.skip(f.offset)),f.limit&&(e=e.first(f.limit)),0===i.length)i=e.value();else switch(f.union_unionall_intersection[h].type){case"union":i=inbrowser.union(i,e.value());break;case"unionall":i=inbrowser.unionall(i,e.value());break;case"intersection":i=inbrowser.intersection(i,e.value())}h++}return f.union_unionall_intersection.splice(0,1),f.propogate_filter&&f.after&&f.after.impact&&f.after.impact(i),i},inbrowser.tableAction=function(a){for(var b=pykQuery.table[a].rows_to_be_modified.length,c="",d=pykQuery.table[a],e={},f=0;f<b;f++)switch(e=d.rows_to_be_modified[f],c=e.action){case"insert":inbrowser.tableInsert(a,e);break;case"update":inbrowser.tableUpdate(a,e);break;case"delete":inbrowser.tableDelete(a,e)}d.rows_to_be_modified=[]},inbrowser.groupby=function(a,b){var c,d,e,f,g,h,i,j=pykQuery.query[a].config,k=j.dim,l=k?k.length:0,m=j.met,n=m?m.length:0,o=j.groupby,p=o.length,q=j.aggregation,r="return ",s=[];for(d=0;d<p;d++)r+=validateDataType(o[d],"string")?"d['"+o[d]+"']":"("+o[d].toString()+")(d)",d<p-1&&(r+="+ '|' + ");if(e=new Function("d",r),q&&(c=q.length),g=b.groupBy(e).each(function(a){for(f={},d=0;d<l;d++)"*"!==k[d].name&&(validateDataType(k[d].name,"string")?f[k[d].alias]=a[0][k[d].name]:f[k[d].alias]=k[d].name(a[0]));for(d=0;d<n;d++)switch(m[d].aggr){case"sum":f[m[d].alias]=Utility(a).sum(function(a){return+a[m[d].name]});break;case"count":f[m[d].alias]=a.length;break;case"min":f[m[d].alias]=+Utility(a).min(function(a){return+a[m[d].name]})[m[d].name];break;case"max":f[m[d].alias]=+Utility(a).max(function(a){return+a[m[d].name]})[m[d].name];break;case"avg":var b,e=0,g=a.length;for(b=0;b<g;b++)e+=+a[b][m[d].name];f[m[d].alias]=e/g;break;case"custom":f[m[d].alias]=m[d].name(a);break;case"std":h=a.map(function(a){return+a[m[d].name]}),f[m[d].alias]=standardDeviation(h);break;case"variance":h=a.map(function(a){return+a[m[d].name]}),f[m[d].alias]=variance(h);break;case"variance_pop":h=a.map(function(a){return+a[m[d].name]}),f[m[d].alias]=variance(h,!0);break;case"count_distinct":h=a.map(function(a){return+a[m[d].name]}),i=h.filter(function(a,b,c){return c.indexOf(a)===b}),f[m[d].alias]=i.length;break;case"values":f[m[d].alias]=+a[0][m[d].name];break;case"std_pop":h=a.map(function(a){return+a[m[d].name]}),f[m[d].alias]=standardDeviation(h,!0)}if(c)for(d=0;d<c;d++)switch(q[d].aggr){case"sum":f[q[d].alias]=Utility(a).sum(function(a){return+a[q[d].name]});break;case"count":f[q[d].alias]=a.length;break;case"min":f[q[d].alias]=+Utility(a).min(function(a){return+a[q[d].name]})[q[d].name];break;case"max":f[q[d].alias]=+Utility(a).max(function(a){return+a[q[d].name]})[q[d].name];break;case"avg":var j,o=0,p=a.length;for(j=0;j<p;j++)o+=+a[j][q[d].name];f[q[d].alias]=o/p;break;case"custom":f[q[d].alias]=q[d].name(a);break;case"std":h=a.map(function(a){return+a[q[d].name]}),f[q[d].alias]=standardDeviation(h);break;case"variance":h=a.map(function(a){return+a[q[d].name]}),f[q[d].alias]=variance(h);break;case"std_pop":h=a.map(function(a){return+a[q[d].name]}),f[q[d].alias]=standardDeviation(h,!0);break;case"variance_pop":h=a.map(function(a){return+a[q[d].name]}),f[q[d].alias]=variance(h,!0);break;case"count_distinct":h=a.map(function(a){return+a[q[d].name]}),i=h.filter(function(a,b,c){return c.indexOf(a)===b}),f[q[d].alias]=i.length;break;case"values":f[q[d].alias]=+a[0][m[d].name]}s.push(f)}),s=Utility(s),j.having){var t,u="return ",v=j.having;u+=inbrowser.evaluateCondition(v),t=new Function("d",u),s=s.where(t)}return s},inbrowser.where=function(a,b){var c,d,e,f,g,h,i,j=pykQuery.query[a].config,k="",l="",m="return ";if(j.where&&(k=j.where,m+=inbrowser.evaluateCondition(k)),j.impact_filters)for(e=Object.keys(j.impact_filters),c=e.length,j.where&&(m+=" && "),d=0;d<e.length;d++)for(f=j.impact_filters[e[d]],h=f.length,g=0;g<h;g++)k=f[g].column_name,m+=inbrowser.evaluateCondition(k),g<h&&(m+=" && ");return" && "===m.slice(-4)&&(m=m.slice(0,-4)),"return "===m?b:(l=new Function("d",m),i=b.where(l))},inbrowser.evaluateCondition=function(a){for(var b,c,d,e="",f=0,g="",h=a.length;f<h;){if(b="string"==typeof a[f].value?'"'+a[f].value+'"':a[f].value,g="",d="",f>0)switch(a[f].conjunction){case"and":e+=" && ";break;case"or":e+=" || "}if(void 0!==a[f].column_name&&validateDataType(a[f].column_name,"array"))e+="( "+inbrowser.evaluateCondition(a[f].column_name)+" )",f++;else{switch(void 0!==a[f].value&&"Function"===getDataType(a[f].value)&&(b="("+a[f].value.toString()+")(d)"),a[f].condition){case"between":e+='(d["'+a[f].column_name+'"] >= '+b[0]+' &&  d["'+a[f].column_name+'"] <= '+b[1]+")";break;case"notBetween":e+='(d["'+a[f].column_name+'"] < '+b[0]+' ||  d["'+a[f].column_name+'"] > '+b[1]+")";break;case"equal":e+='(d["'+a[f].column_name+'"] == '+b+")";break;case"notEqual":e+='(d["'+a[f].column_name+'"] != '+b+")";break;case"greaterThan":e+='(d["'+a[f].column_name+'"] > '+b+")";break;case"greaterThanEqual":e+='(d["'+a[f].column_name+'"] >= '+b+")";break;case"lessThan":e+='(d["'+a[f].column_name+'"] < '+b+")";break;case"lessThanEqual":e+='(d["'+a[f].column_name+'"] <= '+b+")";break;case"like":e+='(d["'+a[f].column_name+'"].equals('+b+"))";break;case"in":for(c=0;c<b.length;c++)g+="string"==typeof b[c]?'"'+b[c]+'"':b[c],c<b.length-1&&(g+=",");e+="(["+g+'].indexOf(d["'+a[f].column_name+'"]) !== -1)';break;case"notIn":for(c=0;c<b.length;c++)g+="string"==typeof b[c]?'"'+b[c]+'"':b[c],c<b.length-1&&(g+=",");e+="(["+g+'].indexOf(d["'+a[f].column_name+'"]) === -1)';break;case"isNull":e+='(d["'+a[f].column_name+'"]  === undefined || d["'+a[f].column_name+'"] === null || d["'+a[f].column_name+'"] == "null")';break;case"isNotNull":e+='(d["'+a[f].column_name+'"]  !== undefined && d["'+a[f].column_name+'"] !== null && d["'+a[f].column_name+'"] !== "null")';break;default:e+=b}f++}}return e},inbrowser.join=function(a){var b,c,d,e,f,g,h,i,j=pykQuery.query[a].config,k=j.table.length,l="return ",m="",n=[],o=0;for(d=j.table,c=d[0].name,data=pykQuery.table[c].data,h=pykQuery.table[c].columns,o=h.length,f=0;f<o;f++)n.push(c+"."+h[f]);if(1===k)return Utility(data);for(data=inbrowser.setColumns(data,j,c),b=1;b<k;b++)for(c=d[b].name,e=pykQuery.table[c].data,e=inbrowser.setColumns(e,j,c),data=inbrowser.merge(data,e,d[b],j),h=pykQuery.table[c].columns,o=h.length,f=0;f<o;f++)n.push(c+"."+h[f]);for(l+=inbrowser.evaluateCondition(j.on),m=new Function("d",l),i=Utility(data).where(m).value(),b=0;b<k;b++)switch(g=d[b].join_type){case"full":i=inbrowser.unionRows(i,n,d[b-1]),i=inbrowser.unionRows(i,n,d[b]);break;case"left":i=inbrowser.unionRows(i,n,d[b-1]);break;case"right":i=inbrowser.unionRows(i,n,d[b]);break;case"inner":}return Utility(i)},inbrowser.merge=function(a,b,c,d){var e,f=(c.join_type,a.length),g={},h=[],i={},k=b.length;for(e=-1;++e<f;)for(g=a[e],j=-1;++j<k;)i=inbrowser.merge_options(b[j],g),h.push(i);return h},inbrowser.setColumns=function(a,b,c){var d,e,f,g=b.join_columns,h=g.length;return f=JSON.parse(JSON.stringify(a)),d=f.map(function(a){for(obj={},e=0;e<h;e++)void 0!==a[g[e].original_name]&&g[e].new_name===c+"."+g[e].original_name&&(obj[g[e].new_name]=a[g[e].original_name],delete a[g[e].original_name]);return obj=inbrowser.merge_options(a,obj),obj})},inbrowser.merge_options=function(a,b){var c,d={};for(c in a)d[c]=a[c];for(c in b)d[c]=b[c];return d},inbrowser.unionRows=function(a,b,c){for(var d,e,f,g,h=0,i=c.name,j=pykQuery.table[i].data,k=a.length,l=[],m=Object.keys(j[0]),n=m.length,o=0,p={},q=b.length,r=j.length,s=0;h<r;){for(o=0,l=[];o<k;){for(s=0,d=!1;s<n;){if(e=m[s],j[h][e]!==a[o][i+"."+e]){d=!0,l.push(!1);break}s++}d||l.push(!0),o++}if(d=Utility(l).find(function(a){return a===!0}),!d){for(s=0,p={};s<q;)f=b[s],g=f.split("."),j[h][g[1]]&&i===g[0]?p[f]=j[h][g[1]]:p[f]="",s++;a.push(p),k++}h++}return a},inbrowser.union=function(a,b){var c=Utility(a).union(b);return c.value()},inbrowser.unionall=function(a,b){return a.concat(b)},inbrowser.intersection=function(a,b){var c=Utility(a).intersection(b);return c.value()},inbrowser.select=function(a,b){var c,d,e,f,g,h=pykQuery.query[a].config,i=h.dim,j=i?i.length:0,k=h.met,l=k?k.length:0;return i&&"*"===i[0].name?b:b=b.map(function(a){for(f={},c=0;c<j;c++)d=i[c],g=d.alias,f[g]&&(g=d.name),validateDataType(d.name,"function")?f[d.alias]=d.name(a):f[g]=void 0===a[d.alias]?a[d.name]:a[d.alias];for(c=0;c<l;c++)e=k[c],validateDataType(e.name,"function")?f[e.alias]=e.name(a):f[e.alias]=a[e.alias];return f})},inbrowser.orderBy=function(a,b){var c,d=pykQuery.query[a].config,e=d.order_by,f=(e.length,[]);return c=generateFunction(e),f=b.sort(c)},inbrowser.distinct=function(a,b){var c,d,e,f,g=pykQuery.query[a].config,h=g.dim,i="return ";if(h&&"*"!==h[0].name)if(h&&1===h.length&&validateDataType(h[0].name,"string"))i+="(d['"+h[0].name+"'])";else for(d=h.length,e=0;e<d;e++)e&&(i+=" + "),i+=validateDataType(h[e].name,"function")?h[e].name+"(d)":"d['"+h[e].name+"']";else i='var keys = Object.keys(d),length = keys.length,str = "";for(i = 0; i < length; i++) {str += d[keys[i]];}return str;';return f=new Function("d",i),c=b.uniq(f)},inbrowser.tableInsert=function(a,b){pykQuery.table[a].data.push(b.data)},inbrowser.tableUpdate=function(a,b){},inbrowser.tableDelete=function(a,b){};var sql_utility=function(){var a={};return a.createSQLString=function(b,c){var d="",e=pykQuery.query[c].config;return d+=a.selectString(e,b),d+=1===e.table.length?a.fromString(e,b):a.joinString(e,b),e.where&&(d+=" where "+a.whereString(e.where,b)),e.groupby&&(d+=a.groupbyString(e,b)),e.having&&(d+=" having "+a.whereString(e.having,b,"having")),e.order_by&&(d+=a.orderbyString(e,b)),e.limit&&(d+=a.limitString(e,b)),e.offset&&(d+=a.offsetString(e,b)),d},a.selectString=function(a,b){var c,d,e,f,g,h,i,j=a.dim,k=j?j.length:0,l=a.met,m=l?l.length:0,n=a.table.length;if(h="select ",k&&"*"===j[0].name)h+="*";else{for(c=0;c<k;c++){for(f=j[c],e=!1,d=0;d<n;d++)f.name===a.table[d].name+"."+f.alias&&(e=!0);h+=f.alias===f.name||e?(f.use_quotes?'"':"")+f.name+(f.use_quotes?'"':""):(f.use_quotes?'"':"")+f.name+(f.use_quotes?'"':"")+" as "+(f.use_quotes?'"':"")+f.alias+(f.use_quotes?'"':""),c<k-1&&(h+=",")}for(m>0&&k>0&&(h+=","),c=0;c<m;c++)g=l[c],i=g.name,h+=g.isCustom?g.name+' as "'+g.alias+'"':"values"===g.aggr?(g.use_quotes?'"':"")+i+(g.use_quotes?'"':"")+" as "+(g.use_quotes?'"':"")+g.alias+(g.use_quotes?'"':""):g.aggr+"("+(g.use_quotes?'"':"")+i+(g.use_quotes?'"':"")+") as "+(g.use_quotes?'"':"")+g.alias+(g.use_quotes?'"':""),c<m-1&&(h+=",")}return h},a.fromString=function(a,b){var c=' from "'+(pykQuery.table[b].data.schema_name?pykQuery.table[b].data.schema_name+'"."':"")+b+'"';return c},a.whereString=function(b,c,d){var e,f,g,h,i=b.length,j="";for(e=0;e<i;e++){if(e>0)switch(b[e].conjunction){case"and":j+=" and ";break;case"or":j+=" or "}if(h=b[e].column_name,b[e].use_quotes||(b[e].column_name=h.split(";")[0]),void 0!==b[e].column_name&&validateDataType(b[e].column_name,"array"))j+="( "+a.whereString(b[e].column_name,c)+" )";else switch("having"===d&&b[e].actual_column_name?(f=Object.keys(b[e].actual_column_name),h=b[e].actual_column_name[f]+"("+(b[e].use_quotes?'"':"")+f+(b[e].use_quotes?'"':"")+")"):h=(b[e].use_quotes?'"':"")+b[e].column_name+(b[e].use_quotes?'"':""),b[e].condition){case"between":j+=h+" BETWEEN "+b[e].value[0]+" and "+b[e].value[1];break;case"notBetween":j+=h+" NOT BETWEEN "+b[e].value[0]+" and "+b[e].value[1];break;case"equal":"on"===d?(console.log("clauses",b[e]),g=b[e].value.split(";"),j+=2===g.length?b[e].column_name+" = "+g[0]:h+" = "+b[e].value):j+=h+" = "+b[e].value;break;case"notEqual":"on"===d?(g=b[e].value.split(";"),j+=2===g.length?b[e].column_name+" != "+g[0]:h+" != "+b[e].value):j+=h+" != "+b[e].value;break;case"greaterThan":"on"===d?(g=b[e].value.split(";"),j+=2===g.length?b[e].column_name+" > "+g[0]:h+" > "+b[e].value):j+=h+" > "+b[e].value;break;case"greaterThanEqual":"on"===d?(g=b[e].value.split(";"),j+=2===g.length?b[e].column_name+" >= "+g[0]:h+" >= "+b[e].value):j+=h+" >= "+b[e].value;break;case"lessThan":"on"===d?(g=b[e].value.split(";"),j+=2===g.length?b[e].column_name+" < "+g[0]:h+" < "+b[e].value):j+=h+" < "+b[e].value;break;case"lessThanEqual":"on"===d?(g=b[e].value.split(";"),j+=2===g.length?b[e].column_name+" <= "+g[0]:h+" <= "+b[e].value):j+=h+" <= "+b[e].value;break;case"iLike":j+="postgresql"===pykQuery.table[c].adapter?"LOWER("+h+"::varchar) LIKE '"+b[e].value+"'":"LOWER("+h+") LIKE '"+b[e].value+"'";break;case"notILike":j+="postgresql"===pykQuery.table[c].adapter?"LOWER("+h+"::varchar) NOT LIKE '"+b[e].value+"'":"LOWER("+h+") NOT LIKE '"+b[e].value+"'";break;case"in":j+=h+" IN ("+b[e].value.join(",")+")";break;case"notIn":j+=h+" NOT IN ("+b[e].value.join(",")+")";break;case"isNull":j+=h+" IS NULL";break;case"isNotNull":j+=h+" IS NOT NULL"}}return j},a.groupbyString=function(a,b){var c,d,e=a.groupby,f=a.groupby.length,g="";for(f>0&&(g+=" group by "),c=0;c<f;c++)d=e[c].split(";"),g+=2===d.length?d[0]+",":'"'+e[c]+'",';return g=g.replace(/,\s*$/,"")},a.orderbyString=function(a,b){var c,d=a.order_by,e=d.length,f=" order by ";for(c=0;c<e;c++)f+=d[c].use_quotes?'"'+d[c].column_name+'" ':d[c].column_name+" ",f+=d[c].sort_type,c<e-1&&(f+=",");return f},a.limitString=function(a,b){return" limit "+a.limit},a.offsetString=function(a,b){
return" offset "+a.offset},a.joinString=function(b,c){var d,e="",f=b.table,g=f.length,h=["inner","left","right","full"],i=["INNER JOIN","LEFT JOIN","RIGHT JOIN","FULL OUTER JOIN"];for(e+=' from "'+(f[0].schema_name?f[0].schema_name+'"."':"")+f[0].name+(f[0].name===f[0].alias?'" ':'" as "'+f[0].alias+'"'),d=1;d<g;d++)e+=" "+i[h.indexOf(f[d].join_type)]+' "'+(f[d].schema_name?f[d].schema_name+'"."':"")+f[d].name+(f[d].name===f[d].alias?'" ':'" as "'+f[d].alias+'"'),e+=" on "+a.whereString([b.on[d-1]],c,"on");return e},a},sql_query_and_connection_utility={};sql_query_and_connection_utility.executeQueryOnNodeDB=function(a,b,c,d){var e=new DataConnector;e.setConnectionParams(a),e.query(b).then(c,d)},sql_query_and_connection_utility.executeQueryOnWebAPIDB=function(a,b,c){sendHTTPRequest({action:"POST",url:pykQuery.dataConnector.queryUrl,headers:{"Content-Type":"application/json"},success:function(a){if(a)switch(a=JSON.parse(a),a.status){case"ok":b(a);break;case"error":c(a)}},error:function(a){a&&(a=JSON.parse(a),c(a))},request:JSON.stringify(a)})},sql_query_and_connection_utility.testConnectionOnNodeDB=function(a,b,c){sql_query_and_connection_utility.executeQueryOnNodeDB(a,c,function(c){if(c.rows[0]){pykQuery.table[b].columns=Object.keys(c.rows[0]),pykQuery.table[b].status=2;var d,e=pykQuery.table[b].onComplete,f=e.length;for(d=0;d<f;d++)e[d].func.apply(e[d].func,e[d].params);a.successCallback&&a.successCallback()}else a.errorCallback&&a.errorCallback("Table is empty")},function(b){a.errorCallback&&a.errorCallback(b)})},sql_query_and_connection_utility.testConnectionOnWebAPIDB=function(a,b,c){sql_query_and_connection_utility.executeQueryOnWebAPIDB(b,function(b){var d=b.result;if(d.rows[0]){pykQuery.table[c].columns=Object.keys(d.rows[0]),pykQuery.table[c].status=2;var e,f=pykQuery.table[c].onComplete,g=f.length;for(e=0;e<g;e++)f[e].func.apply(f[e].func,f[e].params);a.successCallback&&a.successCallback()}else a.errorCallback&&a.errorCallback("Table is empty")},function(b){var c=b.error;a.errorCallback&&a.errorCallback(c)})};var odbc=new sql_utility;odbc.getData=function(a,b,c,d){var e,f=a,g=b,h=pykQuery.table[f].data,i=odbc.createodbcString(f,g);h.isWeb?(e={connectionParams:h,query:i},sql_query_and_connection_utility.executeQueryOnWebAPIDB(e,function(a){var b=a.result;c(b.rows,i)},function(a){var b=a.error;d(b,i)})):sql_query_and_connection_utility.executeQueryOnNodeDB(h,i,function(a){c(a.rows,i)},function(a){d&&d(a,i)})},odbc.createodbcString=function(a,b){return odbc.createSQLString(a,b)},odbc.fromString=function(a,b){var c=' from "'+b+'"';return c};var postgresql=new sql_utility;postgresql.getData=function(a,b,c,d){var e,f=a,g=b,h=pykQuery.table[f].data,i=postgresql.createPostgresqlString(f,g);h.isWeb?(e={connectionParams:h,query:i},sql_query_and_connection_utility.executeQueryOnWebAPIDB(e,function(a){var b=a.result;c(b.rows,i)},function(a){var b=a.error;d(b,i)})):sql_query_and_connection_utility.executeQueryOnNodeDB(h,i,function(a){c(a.rows,i)},function(a){d&&d(a,i)})},postgresql.createPostgresqlString=function(a,b){return postgresql.createSQLString(a,b)},postgresql.fromString=function(a,b){var c=' from "'+(pykQuery.table[b].data.schema_name?pykQuery.table[b].data.schema_name+'"."':"")+b+'"';return c};var redshift=new sql_utility;redshift.getData=function(a,b,c,d){var e,f=a,g=b,h=pykQuery.table[f].data,i=redshift.createRedshiftString(f,g);h.isWeb?(e={connectionParams:h,query:i},sql_query_and_connection_utility.executeQueryOnWebAPIDB(e,function(a){var b=a.result;c(b.rows,i)},function(a){var b=a.error;d(b,i)})):sql_query_and_connection_utility.executeQueryOnNodeDB(h,i,function(a){c(a.rows,i)},function(a){d&&d(a,i)})},redshift.createRedshiftString=function(a,b){return redshift.createSQLString(a,b)},redshift.fromString=function(a,b){var c=' from "'+(pykQuery.table[b].data.schema_name?pykQuery.table[b].data.schema_name+'"."':"")+b+'"';return c};var mysql=new sql_utility;mysql.getData=function(a,b,c,d){var e,f=a,g=b,h=pykQuery.table[f].data,i=mysql.createMysqlString(f,g);h.isWeb?(e={connectionParams:h,query:i},sql_query_and_connection_utility.executeQueryOnWebAPIDB(e,function(a){var b=a.result;c(b.rows,i)},function(a){var b=a.error;d(b,i)})):sql_query_and_connection_utility.executeQueryOnNodeDB(h,i,function(a){c(a.rows,i)},function(a){d&&d(a,i)})},mysql.createMysqlString=function(a,b){return mysql.createSQLString(a,b)},mysql.fromString=function(a,b){var c=" from `"+(pykQuery.table[b].data.schema_name?pykQuery.table[b].data.schema_name+"`.`":"")+b+"`";return c},mysql.selectString=function(a,b){var c,d,e,f,g,h,i,j=a.dim,k=j?j.length:0,l=a.met,m=l?l.length:0,n=a.table.length;if(h="select ",k&&"*"===j[0].name)h+="*";else{for(c=0;c<k;c++){for(f=j[c],e=!1,d=0;d<n;d++)f.name===a.table[d].name+"."+f.alias&&(e=!0);h+=f.alias===f.name||e?(f.use_quotes?"`":"")+f.name+(f.use_quotes?"`":""):(f.use_quotes?"`":"")+f.name+(f.use_quotes?"`":"")+" as "+(f.use_quotes,"`")+f.alias+(f.use_quotes,"`"),c<k-1&&(h+=",")}for(m>0&&k>0&&(h+=","),c=0;c<m;c++)g=l[c],i=g.name,h+=g.isCustom?g.name+" as `"+g.alias+"`":"values"===g.aggr?(g.use_quotes?"`":"")+i+(g.use_quotes?"`":"")+" as `"+g.alias+"`":g.aggr+"("+(g.use_quotes?"`":"")+i+(g.use_quotes?"`":"")+") as `"+g.alias+"`",c<m-1&&(h+=",")}return h},mysql.whereString=function(a,b,c){var d,e,f,g,h=a.length,i="";for(d=0;d<h;d++){if(d>0)switch(a[d].conjunction){case"and":i+=" and ";break;case"or":i+=" or "}if(g=a[d].column_name,a[d].use_quotes||(a[d].column_name=g.split(";")[0]),void 0!==a[d].column_name&&validateDataType(a[d].column_name,"array"))i+="( "+mysql.whereString(a[d].column_name,b)+" )";else switch("having"===c&&a[d].actual_column_name?(e=Object.keys(a[d].actual_column_name),g=a[d].actual_column_name[e]+"("+(a[d].use_quotes?"`":"")+e+(a[d].use_quotes?"`":"")+")"):g=(a[d].use_quotes?"`":"")+a[d].column_name+(a[d].use_quotes?"`":""),a[d].condition){case"between":i+=g+" BETWEEN "+a[d].value[0]+" and "+a[d].value[1];break;case"notBetween":i+=g+" NOT BETWEEN "+a[d].value[0]+" and "+a[d].value[1];break;case"equal":"on"===c?(f=a[d].value.split(";"),i+=2===f.length?a[d].column_name+" = "+f[0]:g+" = "+a[d].value):i+=g+" = "+a[d].value;break;case"notEqual":"on"===c?(f=a[d].value.split(";"),i+=2===f.length?a[d].column_name+" != "+f[0]:g+" != "+a[d].value):i+=g+" != "+a[d].value;break;case"greaterThan":"on"===c?(f=a[d].value.split(";"),i+=2===f.length?a[d].column_name+" > "+f[0]:g+" > "+a[d].value):i+=g+" > "+a[d].value;break;case"greaterThanEqual":"on"===c?(f=a[d].value.split(";"),i+=2===f.length?a[d].column_name+" >= "+f[0]:g+" >= "+a[d].value):i+=g+" >= "+a[d].value;break;case"lessThan":"on"===c?(f=a[d].value.split(";"),i+=2===f.length?a[d].column_name+" < "+f[0]:g+" < "+a[d].value):i+=g+" < "+a[d].value;break;case"lessThanEqual":"on"===c?(f=a[d].value.split(";"),i+=2===f.length?a[d].column_name+" <= "+f[0]:g+" <= "+a[d].value):i+=g+" <= "+a[d].value;break;case"iLike":i+="LOWER("+g+") LIKE '"+a[d].value+"'";break;case"notILike":i+="LOWER("+g+") NOT LIKE '"+a[d].value+"'";break;case"in":i+=g+" IN ("+a[d].value.join(",")+")";break;case"notIn":i+=g+" NOT IN ("+a[d].value.join(",")+")";break;case"isNull":i+=g+" IS NULL";break;case"isNotNull":i+=g+" IS NOT NULL"}}return i},mysql.groupbyString=function(a,b){var c,d,e=a.groupby,f=a.groupby.length,g="";for(f>0&&(g+=" group by "),c=0;c<f;c++)d=e[c].split(";"),g+=2===d.length?d[0]+",":"`"+e[c]+"`,";return g=g.replace(/,\s*$/,"")},mysql.orderbyString=function(a,b){var c,d=a.order_by,e=d.length,f=" order by ";for(c=0;c<e;c++)f+=d[c].use_quotes?"`"+d[c].column_name+"` ":d[c].column_name+" ",f+=d[c].sort_type,c<e-1&&(f+=",");return f},mysql.joinString=function(a,b){var c,d="",e=a.table,f=e.length,g=["inner","left","right","full"],h=["INNER JOIN","LEFT JOIN","RIGHT JOIN","FULL OUTER JOIN"];for(d+=" from `"+(e[0].schema_name?e[0].schema_name+"`.`":"")+e[0].name+(e[0].name===e[0].alias?"` ":"` as `"+e[0].alias+"`"),c=1;c<f;c++)d+=" "+h[g.indexOf(e[c].join_type)]+" `"+(e[c].schema_name?e[c].schema_name+"`.`":"")+e[c].name+(e[c].name===e[c].alias?"` ":"` as `"+e[c].alias+"`"),d+=" on "+mysql.whereString([a.on[c-1]],b,"on");return d};var mssql=new sql_utility;mssql.getData=function(a,b,c,d){var e,f=a,g=b,h=pykQuery.table[f].data,i=mssql.createSQLString(f,g);h.isWeb?(e={connectionParams:h,query:i},sql_query_and_connection_utility.executeQueryOnWebAPIDB(e,function(a){var b=a.result;c(b.rows,i)},function(a){var b=a.error;d(b,i)})):sql_query_and_connection_utility.executeQueryOnNodeDB(h,i,function(a){c(a.rows,i)},function(a){d&&d(a,i)})},mssql.createSQLString=function(a,b){var c="",d=pykQuery.query[b].config;return c+=mssql.selectString(d,a),c+=1===d.table.length?mssql.fromString(d,a):mssql.joinString(d,a),d.where&&(c+=" where "+mssql.whereString(d.where,a)),d.groupby&&(c+=mssql.groupbyString(d,a)),d.having&&(c+=" having "+mssql.whereString(d.having,a,"having")),d.order_by&&(c+=mssql.orderbyString(d,a)),c},mssql.selectString=function(a,b){var c,d,e,f,g,h,i,j=a.dim,k=j?j.length:0,l=a.met,m=l?l.length:0,n=a.table.length;if(h="select ",a.limit&&(h+=mssql.limitString(a,b)),k&&"*"===j[0].name)h+="*";else{for(c=0;c<k;c++){for(f=j[c],e=!1,d=0;d<n;d++)f.name===a.table[d].name+"."+f.alias&&(e=!0);h+=f.alias===f.name||e?(f.use_quotes?"[":"")+f.name+(f.use_quotes?"]":""):(f.use_quotes?"[":"")+f.name+(f.use_quotes?"]":"")+" as "+(f.use_quotes?"[":"")+f.alias+(f.use_quotes?"]":""),c<k-1&&(h+=",")}for(m>0&&k>0&&(h+=","),c=0;c<m;c++)g=l[c],i=g.name,h+=g.aggr+"("+(g.use_quotes?'"':"")+i+(g.use_quotes?'"':"")+") as "+(g.use_quotes?"[":"")+g.alias+(g.use_quotes?"]":""),c<m-1&&(h+=",")}return h},mssql.limitString=function(a,b){return" top "+a.limit+" "},mssql.fromString=function(a,b){var c=" from ["+(pykQuery.table[b].data.schema_name?pykQuery.table[b].data.schema_name+"].[":"")+b+"]";return c},mssql.joinString=function(a,b){var c,d="",e=a.table,f=e.length,g=["inner","left","right","full"],h=["INNER JOIN","LEFT JOIN","RIGHT JOIN","FULL OUTER JOIN"];for(d+=" from ["+(e[0].schema_name?e[0].schema_name+"].[":"")+e[0].name+(e[0].name===e[0].alias?"] ":"] as ["+e[0].alias+"]"),c=1;c<f;c++)d+=" "+h[g.indexOf(e[c].join_type)]+" ["+(e[c].schema_name?e[c].schema_name+"].[":"")+e[c].name+(e[c].name===e[c].alias?"] ":"] as ["+e[c].alias+"]"),d+=" on "+mysql.whereString([a.on[c-1]],b,"on");return d};var sqlite=new sql_utility;sqlite.getData=function(a,b,c,d){var e,f=a,g=b,h=pykQuery.table[f].data,i=sqlite.createSqliteString(f,g);h.isWeb?(e={connectionParams:h,query:i},sql_query_and_connection_utility.executeQueryOnWebAPIDB(e,function(a){var b=a.result;c(b.rows,i)},function(a){var b=a.error;d(b,i)})):sql_query_and_connection_utility.executeQueryOnNodeDB(h,i,function(a){c(a.rows,i)},function(a){d(a,i)})},sqlite.createSqliteString=function(a,b){return sqlite.createSQLString(a,b)},sqlite.selectString=function(a,b){var c,d,e,f,g,h,i,j=a.dim,k=j?j.length:0,l=a.met,m=l?l.length:0,n=a.table.length;if(h="select ",k&&"*"===j[0].name)h+="*";else{for(c=0;c<k;c++){for(f=j[c],e=!1,d=0;d<n;d++)f.name===a.table[d].name+"."+f.alias&&(e=!0);h+=f.alias===f.name||e?(f.use_quotes?'"':"")+f.name+(f.use_quotes?'"':""):(f.use_quotes?'"':"")+f.name+(f.use_quotes?'"':"")+" as "+(f.use_quotes,'"')+f.alias+(f.use_quotes,'"'),c<k-1&&(h+=",")}for(m>0&&k>0&&(h+=","),c=0;c<m;c++)g=l[c],i=g.name,h+=g.isCustom?g.name+' as "'+g.alias+'"':"values"===g.aggr?(g.use_quotes?'"':"")+i+(g.use_quotes?'"':"")+' as "'+g.alias+'"':g.aggr+"("+(g.use_quotes?'"':"")+i+(g.use_quotes?'"':"")+') as "'+g.alias+'"',c<m-1&&(h+=",")}return h},sqlite.groupbyString=function(a,b){var c,d,e=a.groupby,f=a.groupby.length,g="";for(f>0&&(g+=" group by "),c=0;c<f;c++)d=e[c].split(";"),g+=2===d.length?d[0]+",":'"'+e[c]+'",';return g=g.replace(/,\s*$/,"")},sqlite.whereString=function(a,b,c){var d,e,f,g,h=a.length,i="";for(d=0;d<h;d++){if(d>0)switch(a[d].conjunction){case"and":i+=" and ";break;case"or":i+=" or "}if(g=a[d].column_name,a[d].use_quotes||(a[d].column_name=g.split(";")[0]),void 0!==a[d].column_name&&validateDataType(a[d].column_name,"array"))i+="( "+sqlite.whereString(a[d].column_name,b)+" )";else switch("having"===c&&a[d].actual_column_name?(e=Object.keys(a[d].actual_column_name),f=(a[d].use_quotes?'"':"")+a[d].actual_column_name[e]+(a[d].use_quotes?'"':"")+"("+e+")"):f=(a[d].use_quotes?'"':"")+a[d].column_name+(a[d].use_quotes?'"':""),a[d].condition){case"between":i+=f+" BETWEEN "+a[d].value[0]+" and "+a[d].value[1];break;case"notBetween":i+=f+" NOT BETWEEN "+a[d].value[0]+" and "+a[d].value[1];break;case"equal":i+=f+" = "+a[d].value;break;case"notEqual":i+=f+" != "+a[d].value;break;case"greaterThan":i+=f+" > "+a[d].value;break;case"greaterThanEqual":i+=f+" >= "+a[d].value;break;case"lessThan":i+=f+" < "+a[d].value;break;case"lessThanEqual":i+=f+" <= "+a[d].value;break;case"iLike":i+="LOWER("+g+") LIKE '"+a[d].value+"'";break;case"notILike":i+="LOWER("+g+") NOT LIKE '"+a[d].value+"'";break;case"in":i+=f+" IN ("+a[d].value.join(",")+")";break;case"notIn":i+=f+" NOT IN ("+a[d].value.join(",")+")";break;case"isNull":i+=f+" IS NULL";break;case"isNotNull":i+=f+" IS NOT NULL"}}return i},sqlite.orderbyString=function(a,b){var c,d=a.order_by,e=d.length,f=" order by ";for(c=0;c<e;c++)f+=d[c].use_quotes?'"'+d[c].column_name+'" ':d[c].column_name+" ",f+=d[c].sort_type,c<e-1&&(f+=",");return f},sqlite.fromString=function(a,b){var c=' from "'+b+'"';return c};var jsonToUrl=function(a){var b,c,d="",e=Object.keys(a),f=e.length;for(c=0;c<f;c++)b=e[c],d+=encodeURIComponent(b)+"="+a[b]+(c!==f-1?"&":"");return d},sendHTTPRequest=function(a){var b,c,d,e,f,g,h,i,j;for(e=new XMLHttpRequest,e.onload=function(b){4===e.readyState&&(201===e.status||200===e.status?a.success(e.responseText,a.params):(console.error(e.statusText),a.error(e.responseText)))},e.onerror=function(b){console.error(e.statusText),a.error(e.responseText)},b=a.action,c=a.url,d=a.async!==!1,a.headers&&(h=a.headers,i=Object.keys(h),f=i.length),e.open(b,c,d),g=0;g<f;g++)e.setRequestHeader(i[g],h[i[g]]);a.request?(j="string"==typeof a.request?a.request:jsonToUrl(a.request),e.send(j)):e.send()};Utility.identity=function(a){return a},List.prototype.size=function(){return this.getIndex().length()},List.prototype.getmovenext=function(){return new MoveNext(this)},List.prototype.root=function(){return this.parent.root()},List.prototype.value=function(){return this.toArray()},List.prototype.apply=function(a){var b,c=this.root(),d=c.source;try{c.source=a,b=this.value()}finally{c.source=d}return b},MoveNext.prototype.moveNext=function(){var a=this.cachedIndex;return a||(a=this.cachedIndex=this.list.getIndex()),!(this.index>=a.length()-1)&&(++this.index,!0)},List.prototype.toArray=function(){return this.reduce(function(a,b){return a.push(b),a},[])},List.prototype.getIndex=function(){return new ArrayWrapper(this.toArray())},List.prototype.toObject=function(){return this.reduce(function(a,b){return a[b[0]]=b[1],a},{})},List.prototype.each=function(a){for(var b=this.getmovenext(),c=-1;b.moveNext();)if(a(b.current(),++c)===!1)return!1;return!0},List.prototype.forEach=function(a){return this.each(a)},List.prototype.map=function(a){return new MappedList(this,createCallback(a))},List.prototype.collect=function(a){return this.map(a)},MappedList.prototype=new List,MappedList.prototype.getmovenext=function(){return new MappingMoveNext(this.parent,this.mapFn)},MappedList.prototype.each=function(a){var b=this.mapFn;return this.parent.each(function(c,d){return a(b(c,d),d)})},List.prototype.pluck=function(a){return this.map(a)},List.prototype.invoke=function(a){return this.map(function(b){return b[a]()})},List.prototype.filter=function(a){return new FilteredList(this,createCallback(a))},List.prototype.select=function(a){return this.filter(a)},FilteredList.prototype=new List,FilteredList.prototype.getmovenext=function(){return new FilteringMoveNext(this.parent,this.filterFn)},FilteredList.prototype.each=function(a){var b=this.filterFn,c=0;return this.parent.each(function(d,e){if(b(d,e))return a(d,c++)})},FilteredList.prototype.reverse=function(){return this.parent.reverse().filter(this.filterFn)},FilteringMoveNext.prototype.current=function(){return this.value},FilteringMoveNext.prototype.moveNext=function(){for(var a,b=this.movenext,c=this.filterFn;b.moveNext();)if(a=b.current(),c(a,this.index++))return this.value=a,!0;return this.value=void 0,!1},List.prototype.reject=function(a){return a=createCallback(a),this.filter(function(b){return!a(b)})},List.prototype.where=function(a){return this.filter(a)},List.prototype.reverse=function(){return new ReversedList(this)},ReversedList.prototype=new List,ReversedList.prototype.getmovenext=function(){return new ReversedMoveNext(this.parent)},ReversedMoveNext.prototype.current=function(){return this.getIndex().get(this.index)},ReversedMoveNext.prototype.moveNext=function(){var a=this.getIndex(),b=a.length();return"undefined"==typeof this.index&&(this.index=b),--this.index>=0},ReversedMoveNext.prototype.getIndex=function(){return this.cachedIndex||(this.cachedIndex=this.list.getIndex()),this.cachedIndex},List.prototype.first=function(a){return"undefined"==typeof a?getFirst(this):new TakeList(this,a)},List.prototype.head=List.prototype.take=function(a){return this.first(a)},TakeList.prototype=new List,TakeList.prototype.getmovenext=function(){return new TakeMoveNext(this.parent,this.count)},TakeList.prototype.each=function(a){var b,c=this.count,d=0,e=this.parent.each(function(e){return d<c&&(b=a(e,d++)),!(d>=c)&&b});return e instanceof AsyncHandle?e:d===c&&b!==!1},List.prototype.initial=function(a){return new InitialList(this,a)},List.prototype.findWhere=function(a){return this.where(a).first()},List.prototype.skip=List.prototype.tail=List.prototype.drop=function(a){return this.rest(a)},List.prototype.sort=function(a,b){return a||(a=compare),b&&(a=reverseArguments(a)),new SortedList(this,a)},SortedList.prototype=new List,SortedList.prototype.each=function(a){var b=this.sortFn,c=this.parent.toArray();return c.sort(b),forEach(c,a)},SortedList.prototype.reverse=function(){return new SortedList(this.parent,reverseArguments(this.sortFn))},List.prototype.initial=function(a){return new InitialList(this,a)},InitialList.prototype=new List,InitialList.prototype.each=function(a){var b=this.parent.getIndex();return b.take(b.length()-this.count).each(a)},List.prototype.last=function(a){return"undefined"==typeof a?this.reverse().first():this.reverse().take(a).reverse()},List.prototype.findWhere=function(a){return this.where(a).first()},List.prototype.rest=function(a){return new DropList(this,a)},List.prototype.skip=List.prototype.tail=List.prototype.drop=function(a){return this.rest(a)},DropList.prototype=new List,DropList.prototype.each=function(a){var b=this.count,c=0,d=0;return this.parent.each(function(e){if(!(c++<b))return a(e,d++)})},List.prototype.skipWhile=function(a){return this.dropWhile(a)},List.prototype.sortBy=function(a,b){return a=createComparator(a),b&&(a=reverseArguments(a)),new SortedList(this,a)},List.prototype.groupBy=function(a,b){return new GroupedList(this,a,b)},List.prototype.indexBy=function(a,b){return new IndexedList(this,a,b)},List.prototype.countBy=function(a){return new CountedList(this,a)},List.prototype.uniq=function(a){return new UniqueList(this,a)},List.prototype.unique=function(a){return this.uniq(a)},UniqueList.prototype=new List,UniqueList.prototype.each=function(a){var b=new Set,c=this.keyFn,d=0;return c?(c=createCallback(c),this.parent.each(function(e){if(b.add(c(e)))return a(e,d++)})):this.parent.each(function(c){if(b.add(c))return a(c,d++)})},List.prototype.flatten=function(){return new FlattenedList(this)},FlattenedList.prototype=new List,FlattenedList.prototype.each=function(a){var b=0;return this.parent.each(function c(d){return d instanceof Array?forEach(d,c):d instanceof List?d.each(c):a(d,b++)})},List.prototype.compact=function(){return this.filter(function(a){return!!a})},List.prototype.without=function(a){return new WithoutList(this,arraySlice.call(arguments,0))},List.prototype.difference=function(a){return this.without.apply(this,arguments)},List.prototype.union=function(a){return this.concat(a).uniq()},List.prototype.intersection=function(a){return 1===arguments.length&&arguments[0]instanceof Array?new SimpleIntersectionList(this,a):new IntersectionList(this,arraySlice.call(arguments,0))},List.prototype.every=function(a){return a=createCallback(a),this.each(function(b,c){return!!a(b,c)})},List.prototype.all=function(a){return this.every(a)},List.prototype.some=function(a){a=createCallback(a,!0);var b=!1;return this.each(function(c){if(a(c))return b=!0,!1}),b},List.prototype.any=function(a){return this.some(a)},List.prototype.none=function(a){return!this.any(a)},List.prototype.isEmpty=function(){return!this.any()},List.prototype.indexOf=function(a){var b=-1;return this.each(function(c,d){if(c===a)return b=d,!1}),b},List.prototype.lastIndexOf=function(a){var b=this.getIndex().reverse(),c=b.indexOf(a);return c!==-1&&(c=b.length()-c-1),c},List.prototype.sortedIndex=function(a){for(var b,c=this.getIndex(),d=0,e=c.length();d<e;)b=d+e>>>1,compare(c.get(b),a)===-1?d=b+1:e=b;return d},List.prototype.contains=function(a){return this.indexOf(a)!==-1},List.prototype.reduce=function(a,b){if(arguments.length<2)return this.tail().reduce(a,this.head());var c=this.each(function(c,d){b=a(b,c,d)});return c instanceof AsyncHandle?c.then(function(){return b}):b},List.prototype.inject=List.prototype.foldl=function(a,b){return this.reduce(a,b)},List.prototype.reduceRight=function(a,b){if(arguments.length<2)return this.initial(1).reduceRight(a,this.last());var c=this.getIndex(),d=c.length()-1;return c.reverse().reduce(function(b,c){return a(b,c,d--)},b)},List.prototype.foldr=function(a,b){return this.reduceRight(a,b)},List.prototype.consecutive=function(a){var b=new Queue(a),c=this.map(function(c){if(b.add(c).count===a)return b.toArray()});return c.compact()},List.prototype.chunk=function(a){if(a<1)throw new Error("You must specify a positive chunk size.");return new ChunkedList(this,a)},ChunkedList.prototype=new List,ChunkedList.prototype.getmovenext=function(){return new ChunkedMoveNext(this.parent,this.chunkSize)},ChunkedMoveNext.prototype.current=function(){return this.currentChunk},ChunkedMoveNext.prototype.moveNext=function(){for(var a=this.movenext,b=this.size,c=[];c.length<b&&a.moveNext();)c.push(a.current());return 0!==c.length&&(this.currentChunk=c,!0)},List.prototype.tap=function(a){return new TappedList(this,a)},List.prototype.find=function(a){return this.filter(a).first()},List.prototype.detect=function(a){return this.find(a)},List.prototype.min=function(a){return"undefined"!=typeof a?this.minBy(a):this.reduce(function(a,b){return b<a?b:a},1/0)},List.prototype.minBy=function(a){return a=createCallback(a),this.reduce(function(b,c){return a(c)<a(b)?c:b})},List.prototype.max=function(a){return"undefined"!=typeof a?this.maxBy(a):this.reduce(function(a,b){return b>a?b:a},-(1/0))},List.prototype.maxBy=function(a){return a=createCallback(a),this.reduce(function(b,c){return a(c)>a(b)?c:b})},List.prototype.sum=function(a){return"undefined"!=typeof a?this.sumBy(a):this.reduce(function(a,b){return a+b},0)},List.prototype.sumBy=function(a){return a=createCallback(a),this.reduce(function(b,c){return b+a(c)},0)},List.prototype.join=function(a){return a="string"==typeof a?a:",",this.reduce(function(b,c,d){return d>0&&(b+=a),b+c},"")},List.prototype.toString=function(a){return this.join(a)},List.prototype.async=function(a){return new AsyncList(this,a)},SimpleIntersectionList.prototype=new List,SimpleIntersectionList.prototype.eachMemoizerCache=function(a){var b=new UniqueMemoizer(Utility(this.array).getmovenext()),c=0;return this.parent.each(function(d){if(b.contains(d))return a(d,c++)})},SimpleIntersectionList.prototype.eachArrayCache=function(a){var b=this.array,c=arrayContains,d=0;return this.parent.each(function(e){if(c(b,e))return a(e,d++)})},ArrayLikeList.prototype=new List,ArrayLikeList.prototype.get=function(a){return this.parent.get(a)},ArrayLikeList.prototype.length=function(){return this.parent.length()},ArrayLikeList.prototype.getIndex=function(){return this},ArrayLikeList.prototype.getmovenext=function(){return new IndexedMoveNext(this)},IndexedMoveNext.prototype.current=function(){return this.list.get(this.index)},IndexedMoveNext.prototype.moveNext=function(){return!(this.index>=this.list.length()-1)&&(++this.index,!0)},ArrayLikeList.prototype.pop=function(){return this.initial()},ArrayLikeList.prototype.shift=function(){return this.drop()},ArrayLikeList.prototype.slice=function(a,b){var c=this.length();a<0&&(a=c+a);var d=this.drop(a);return"number"==typeof b&&(b<0&&(b=c+b),d=d.take(b-a)),d},ArrayLikeList.prototype.filter=function(a){return new IndexedFilteredList(this,createCallback(a))},IndexedFilteredList.prototype=new FilteredList,IndexedFilteredList.prototype.each=function(a){for(var b,c=this.parent,d=this.filterFn,e=this.parent.length(),f=-1,g=0;++f<e;)if(b=c.get(f),d(b,f)&&a(b,g++)===!1)return!1;return!0},ArrayLikeList.prototype.reverse=function(){return new IndexedReversedList(this)},IndexedReversedList.prototype=new ArrayLikeList,IndexedReversedList.prototype.get=function(a){return this.parent.get(this.length()-a-1)},ArrayLikeList.prototype.first=function(a){return"undefined"==typeof a?this.get(0):new IndexedTakeList(this,a)},IndexedTakeList.prototype=new ArrayLikeList,IndexedTakeList.prototype.length=function(){var a=this.parent.length();return this.count<=a?this.count:a},ArrayLikeList.prototype.rest=function(a){return new IndexedDropList(this,a)},IndexedDropList.prototype=new ArrayLikeList,IndexedDropList.prototype.get=function(a){return this.parent.get(this.count+a)},IndexedDropList.prototype.length=function(){var a=this.parent.length();return this.count<=a?a-this.count:0},ArrayLikeList.prototype.concat=function(a){return 1===arguments.length&&arguments[0]instanceof Array?new IndexedConcatenatedList(this,a):List.prototype.concat.apply(this,arguments)},IndexedConcatenatedList.prototype=new ArrayLikeList,IndexedConcatenatedList.prototype.get=function(a){var b=this.parent.length();return a<b?this.parent.get(a):this.other[a-b]},IndexedConcatenatedList.prototype.length=function(){return this.parent.length()+this.other.length},ArrayLikeList.prototype.uniq=function(a){return new IndexedUniqueList(this,createCallback(a))},IndexedUniqueList.prototype=new List,IndexedUniqueList.prototype.eachArrayCache=function(a){for(var b,c,d=this.parent,e=this.keyFn,f=d.length(),g=[],h=arrayContains,i=-1,j=0;++i<f;)if(c=d.get(i),b=e(c),!h(g,b)&&(g.push(b),a(c,j++)===!1))return!1},IndexedUniqueList.prototype.eachSetCache=UniqueList.prototype.each,ArrayWrapper.prototype=new ArrayLikeList,ArrayWrapper.prototype.root=function(){return this},ArrayWrapper.prototype.isAsync=function(){return!1},ArrayWrapper.prototype.get=function(a){return this.source[a]},ArrayWrapper.prototype.length=function(){return this.source.length},ArrayWrapper.prototype.each=function(a){return forEach(this.source,a)},ArrayWrapper.prototype.map=function(a){return new MappedArrayWrapper(this,createCallback(a))},ArrayWrapper.prototype.filter=function(a){return new FilteredArrayWrapper(this,createCallback(a))},ArrayWrapper.prototype.uniq=function(a){return new UniqueArrayWrapper(this,a)},ArrayWrapper.prototype.concat=function(a){return 1===arguments.length&&arguments[0]instanceof Array?new ConcatArrayWrapper(this,a):ArrayLikeList.prototype.concat.apply(this,arguments)},ArrayWrapper.prototype.toArray=function(){return this.source.slice(0)},MappedArrayWrapper.prototype=new ArrayLikeList,MappedArrayWrapper.prototype.get=function(a){var b=this.parent.source;if(!(a<0||a>=b.length))return this.mapFn(b[a])},MappedArrayWrapper.prototype.length=function(){return this.parent.source.length},MappedArrayWrapper.prototype.each=function(a){for(var b=this.parent.source,c=b.length,d=this.mapFn,e=-1;++e<c;)if(a(d(b[e],e),e)===!1)return!1;return!0},FilteredArrayWrapper.prototype=new FilteredList,FilteredArrayWrapper.prototype.each=function(a){for(var b,c=this.parent.source,d=this.filterFn,e=c.length,f=-1,g=0;++f<e;)if(b=c[f],d(b,f)&&a(b,g++)===!1)return!1;return!0},UniqueArrayWrapper.prototype=new List,UniqueArrayWrapper.prototype.eachNoCache=function(a){for(var b,c=this.parent.source,d=this.keyFn,e=c.length,f=arrayContainsBefore,g=-1,h=0;++g<e;)if(b=c[g],!f(c,b,g,d)&&a(b,h++)===!1)return!1;return!0},UniqueArrayWrapper.prototype.eachArrayCache=function(a){var b,c,d=this.parent.source,e=this.keyFn,f=d.length,g=[],h=arrayContains,i=-1,j=0;if(e){for(e=createCallback(e);++i<f;)if(c=d[i],b=e(c),!h(g,b)&&(g.push(b),a(c,j++)===!1))return!1}else for(;++i<f;)if(c=d[i],!h(g,c)&&(g.push(c),a(c,j++)===!1))return!1;return!0},UniqueArrayWrapper.prototype.eachSetCache=UniqueList.prototype.each,ConcatArrayWrapper.prototype=new ArrayLikeList,ConcatArrayWrapper.prototype.get=function(a){var b=this.parent.source,c=b.length;return a<c?b[a]:this.other[a-c]},ConcatArrayWrapper.prototype.length=function(){return this.parent.source.length+this.other.length},ConcatArrayWrapper.prototype.each=function(a){for(var b=this.parent.source,c=b.length,d=this.other,e=d.length,f=0,g=-1;++g<c;)if(a(b[g],f++)===!1)return!1;for(g=-1;++g<e;)if(a(d[g],f++)===!1)return!1;return!0},ObjectLikeList.prototype=new List,ObjectLikeList.prototype.value=function(){return this.toObject()},ObjectLikeList.prototype.get=function(a){var b=this.pairs().find(function(b){return b[0]===a});return b?b[1]:void 0},ObjectLikeList.prototype.keys=function(){return this.map(function(a,b){return b})},ObjectLikeList.prototype.values=function(){return this.map(function(a,b){return a})},ObjectLikeList.prototype.async=function(){throw new Error("An ObjectLikeList does not support asynchronous iteration.")},ObjectLikeList.prototype.filter=function(a){return new FilteredObjectLikeList(this,createCallback(a))},FilteredObjectLikeList.prototype=new ObjectLikeList,FilteredObjectLikeList.prototype.each=function(a){var b=this.filterFn;return this.parent.each(function(c,d){if(b(c,d))return a(c,d)})},ObjectLikeList.prototype.reverse=function(){return this},ObjectLikeList.prototype.pairs=function(){return this.map(function(a,b){return[b,a]})},GroupedList.prototype=new ObjectLikeList,GroupedList.prototype.each=function(a){var b,c=createCallback(this.keyFn),d=createCallback(this.valFn);return b=this.parent.reduce(function(a,b){var e=c(b),f=d(b);return a[e]instanceof Array?a[e].push(f):a[e]=[f],a},{}),transform(function(b){for(var c in b)if(a(b[c],c)===!1)return!1},b)},CountedList.prototype=new ObjectLikeList,CountedList.prototype.each=function(a){var b=createCallback(this.keyFn),c={};this.parent.each(function(a){var d=b(a);c[d]?c[d]+=1:c[d]=1});for(var d in c)if(a(c[d],d)===!1)return!1;return!0},AsyncList.prototype=new List,AsyncList.prototype.isAsync=function(){return!0},AsyncList.prototype.getmovenext=function(){throw new Error("An AsyncList does not support synchronous iteration.")},AsyncList.prototype.each=function(a){var b=this.parent.getmovenext(),c=this.onNextCallback,d=this.cancelCallback,e=0,f=new AsyncHandle(function(){g&&d(g)}),g=c(function h(){g=null;try{b.moveNext()&&a(b.current(),e++)!==!1?g=c(h):f._resolve()}catch(d){f._reject(d)}});return f};var PENDING=1,RESOLVED=2,REJECTED=3;AsyncHandle.prototype.then=function(a,b){var c=new AsyncHandle(this.cancelFn);return this.resolveListeners.push(function(b){try{if("function"!=typeof a)return void resolve(c,b);resolve(c,a(b))}catch(d){c._reject(d)}}),this.rejectListeners.push(function(a){try{if("function"!=typeof b)return void c._reject(a);resolve(c,b(a))}catch(d){c._reject(d)}}),this.state===RESOLVED&&this._resolve(this.value),this.state===REJECTED&&this._reject(this.reason),c},AsyncHandle.prototype._resolve=function(a){this.state!==REJECTED&&(this.state===PENDING&&(this.state=RESOLVED,this.value=a),consumeListeners(this.resolveListeners,this.value))},AsyncHandle.prototype._reject=function(a){this.state!==RESOLVED&&(this.state===PENDING&&(this.state=REJECTED,
this.reason=a),consumeListeners(this.rejectListeners,this.reason))},AsyncHandle.prototype.cancel=function(){this.cancelFn&&(this.cancelFn(),this.cancelFn=null,this._resolve(!1))},AsyncHandle.prototype.onComplete=function(a){return this.resolveListeners.push(a),this},AsyncHandle.prototype.onError=function(a){return this.rejectListeners.push(a),this},Utility.List=List,Utility.ArrayLikeList=ArrayLikeList,Utility.ObjectLikeList=ObjectLikeList,Utility.AsyncList=AsyncList,Utility.AsyncHandle=AsyncHandle;var arrayPop=Array.prototype.pop,arraySlice=Array.prototype.slice;Queue.prototype.add=function(a){var b=this.contents,c=b.length,d=this.start;return this.count===c?(b[d]=a,this.start=(d+1)%c):b[this.count++]=a,this},Queue.prototype.toArray=function(){var a=this.contents,b=this.start,c=this.count,d=a.slice(b,b+c);return d.length<c&&(d=d.concat(a.slice(0,c-d.length))),d},Set.prototype.add=function(a){var b,c=this.table,d=typeof a;switch(d){case"number":case"boolean":case"undefined":return!c[a]&&(c[a]=!0,!0);case"string":switch(a.charAt(0)){case"_":case"f":case"t":case"c":case"u":case"@":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"N":a="@"+a}return!c[a]&&(c[a]=!0,!0);default:return b=this.objects,!arrayContains(b,a)&&(b.push(a),!0)}},Set.prototype.contains=function(a){var b=typeof a;switch(b){case"number":case"boolean":case"undefined":return!!this.table[a];case"string":switch(a.charAt(0)){case"_":case"f":case"t":case"c":case"u":case"@":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"N":a="@"+a}return!!this.table[a];default:return arrayContains(this.objects,a)}},UniqueMemoizer.prototype.current=function(){return this.currentValue},UniqueMemoizer.prototype.moveNext=function(){for(var a,b=this.iterator,c=this.set,d=this.memo;b.moveNext();)if(a=b.current(),c.add(a))return d.push(a),this.currentValue=a,!0;return!1},UniqueMemoizer.prototype.each=function(a){for(var b=this.memo,c=b.length,d=-1;++d<c;)if(a(b[d],d)===!1)return!1;for(;this.moveNext()&&a(this.currentValue,d++)!==!1;);},UniqueMemoizer.prototype.contains=function(a){if(this.set.contains(a))return!0;for(;this.moveNext();)if(this.currentValue===a)return!0;return!1};var validateDataType=function(a,b){switch(b){case"number":return!isNaN(+a)&&isFinite(a);case"array":return a.constructor===Array;case"boolean":return a.constructor===Boolean;case"string":return a.constructor===String;case"object":return a.constructor===Object;case"function":return a.constructor===Function;case"date":return"Invalid Date"!==new Date(a)}return{validateDataType:validateDataType}},getDataType=function(a){switch(a.constructor){case Object:return"Object";case Number:return"Number";case String:return isNaN(a)?"Invalid Date"!==new Date(a).toString()?"Date":"String":"Number";case Array:return"Array";case RegExp:return"RegExp";case Function:return"Function"}},validatePostgresConnectionParams=function(a){var b,c,d,e,f,g="object"==typeof a?Object.keys(a):[],h=["server","port","username","password","dbName","dbType","isWeb","successCallback","errorCallback"],i=["server","port","username","password","dbName","dbType"],j={server:"string",port:"number",username:"string",password:"string",dbName:"string",dbType:"string",isWeb:"boolean",successCallback:"function",errorCallback:"function"},k=!0;if(g.length){for(b=0,c=i.length;b<c;b++)f=i[b],f in a||(k=!1,error("Missing connection parameter:"+f));for(b=0,c=h.length;b<c;b++)f=h[b],f in a&&(d=a[f],e=typeof d,e!==j[f]&&(k=!1,error(f+" should be a "+j[f])));a.dbType&&"postgresql"!==a.dbType&&(k=!1,error("dbType should be 'postgresql'"))}else error("Invalid connection parameters");return k},validateRedshiftConnectionParams=function(a){var b,c,d,e,f,g="object"==typeof a?Object.keys(a):[],h=["server","port","username","password","dbName","dbType","isWeb","successCallback","errorCallback"],i=["server","port","username","password","dbName","dbType"],j={server:"string",port:"number",username:"string",password:"string",dbName:"string",dbType:"string",isWeb:"boolean",successCallback:"function",errorCallback:"function"},k=!0;if(g.length){for(b=0,c=i.length;b<c;b++)f=i[b],f in a||(k=!1,error("Missing connection parameter:"+f));for(b=0,c=h.length;b<c;b++)f=h[b],f in a&&(d=a[f],e=typeof d,e!==j[f]&&(k=!1,error(f+" should be a "+j[f])));a.dbType&&"redshift"!==a.dbType&&(k=!1,error("dbType should be 'redshift'"))}else error("Invalid connection parameters");return k},validateMysqlConnectionParams=function(a){var b,c,d,e,f,g="object"==typeof a?Object.keys(a):[],h=["server","port","username","password","dbName","dbType","isWeb","successCallback","errorCallback"],i=["server","port","username","password","dbName","dbType"],j={server:"string",port:"number",username:"string",password:"string",dbName:"string",dbType:"string",isWeb:"boolean",successCallback:"function",errorCallback:"function"},k=!0;if(g.length){for(b=0,c=i.length;b<c;b++)f=i[b],f in a||(k=!1,error("Missing connection parameter:"+f));for(b=0,c=h.length;b<c;b++)f=h[b],f in a&&(d=a[f],e=typeof d,e!==j[f]&&(k=!1,error(f+" should be a "+j[f])));a.dbType&&"mysql"!==a.dbType&&(k=!1,error("dbType should be 'mysql'"))}else error("Invalid connection parameters");return k},validateODBCConnectionParams=function(a){var b,c,d,e,f,g="object"==typeof a?Object.keys(a):[],h=["server","port","username","password","dbName","dbType","driver","dsn","isWeb","successCallback","errorCallback"],i=["dbType","dsn"],j={server:"string",port:"number",username:"string",password:"string",dbName:"string",dbType:"string",isWeb:"boolean",successCallback:"function",errorCallback:"function",dsn:"string"},k=!0;if(g.length){for(b=0,c=i.length;b<c;b++)f=i[b],f in a||(k=!1,error("Missing connection parameter:"+f));for(b=0,c=h.length;b<c;b++)f=h[b],f in a&&(d=a[f],e=typeof d,e!==j[f]&&(k=!1,error(f+" should be a "+j[f])))}else error("Invalid connection parameters");return k},validateMssqlConnectionParams=function(a){var b,c,d,e,f,g="object"==typeof a?Object.keys(a):[],h=["server","port","username","password","dbName","dbType","driver","isWeb","successCallback","errorCallback"],i=["dbType"],j={server:"string",port:"number",username:"string",password:"string",dbName:"string",dbType:"string",isWeb:"boolean",successCallback:"function",errorCallback:"function"},k=!0;if(g.length){for(b=0,c=i.length;b<c;b++)f=i[b],f in a||(k=!1,error("Missing connection parameter:"+f));for(b=0,c=h.length;b<c;b++)f=h[b],f in a&&(d=a[f],e=typeof d,e!==j[f]&&(k=!1,error(f+" should be a "+j[f])));a.dbType&&"mssql"!==a.dbType&&(k=!1,error("dbType should be 'mssql'"))}else error("Invalid connection parameters");return k},validateSqliteConnectionParams=function(a){var b,c,d,e,f,g="object"==typeof a?Object.keys(a):[],h=["dbName","dbType","isWeb","successCallback","errorCallback"],i=["dbType"],j={dbName:"string",dbType:"string",isWeb:"boolean",successCallback:"function",errorCallback:"function"},k=!0;if(g.length){for(b=0,c=i.length;b<c;b++)f=i[b],f in a||(k=!1,error("Missing connection parameter:"+f));for(b=0,c=h.length;b<c;b++)f=h[b],f in a&&(d=a[f],e=typeof d,e!==j[f]&&(k=!1,error(f+" should be a "+j[f])));a.dbType&&"sqlite"!==a.dbType&&(k=!1,error("dbType should be 'sqlite'"))}else error("Invalid connection parameters");return k};"function"==typeof require&&(module.exports={validateDataType:validateDataType,getDataType:getDataType,validatePostgresConnectionParams:validatePostgresConnectionParams,validateODBCConnectionParams:validateODBCConnectionParams,validateMysqlConnectionParams:validateMysqlConnectionParams,validateMssqlConnectionParams:validateMssqlConnectionParams,validateSqliteConnectionParams:validateSqliteConnectionParams,validateRedshiftConnectionParams:validateRedshiftConnectionParams});var queryProcessor=function(a,b,c,d){var e,f,g,h,i=pykQuery.table[a].adapter,j=pykQuery.query[b].config,k=pykQuery.table;switch((j.filter_impact_array&&j.filter_impact_array.length>0||j.filter_impacted_by_array&&j.filter_impacted_by_array.length>0)&&propogateFilter(b),i){case"inbrowser":h=inbrowser.getData(a,b);break;case"googlequery":h=gql.getData(a,b,c,d);break;case"postgresql":for(g=!0,e=0;e<j.table.length;e++)pykQuery.table[j.table[e].name].status<2&&(g=!1);if(!g)return;postgresql.getData(a,b,c,d);break;case"redshift":for(g=!0,e=0;e<j.table.length;e++)pykQuery.table[j.table[e].name].status<2&&(g=!1);if(!g)return;redshift.getData(a,b,c,d);break;case"odbc":for(g=!0,e=0;e<j.table.length;e++)pykQuery.table[j.table[e].name].status<2&&(g=!1);if(!g)return;odbc.getData(a,b,c,d);break;case"mysql":for(g=!0,e=0;e<j.table.length;e++)pykQuery.table[j.table[e].name].status<2&&(g=!1);if(!g)return;mysql.getData(a,b,c,d);break;case"mssql":for(g=!0,e=0;e<j.table.length;e++)pykQuery.table[j.table[e].name].status<2&&(g=!1);if(!g)return;mssql.getData(a,b,c,d);break;case"sqlite":for(g=!0,e=0;e<j.table.length;e++)pykQuery.table[j.table[e].name].status<2&&(g=!1);if(!g)return;sqlite.getData(a,b,c,d)}if(j.data_impact_array&&j.data_impact_array.length>0)for(f=j.data_impact_array.length,e=0;e<f;e++)k[j.data_impact_array[e]].data=h;return h},tableProcessor=function(a){var b,c=pykQuery.table[a].adapter;switch(c){case"inbrowser":b=inbrowser.tableAction(a);break;case"googlequery":b=gql.tableAction(a)}return b},propogateFilter=function(a){var b,c,d,e,f,g=pykQuery.query[a].config,h=g.filter_impact_array||[],i=g.filter_impacted_by_array||[],j={};for(g.propagated=!0,g.impact_filters={},f=i.length,e=0;e<f;e++)c=i[e],b=pykQuery.query[c].config,g.impact_filters[c]=g.impact_filters[c]||[],b.where&&(j={},j.conjunction="and",j.column_name=b.where,j.query_name=c,g.impact_filters[c].push(j)),d=g.impact_filters[c].length,d&&(g.impact_filters[c][0].conjunction="");for(f=h.length,e=0;e<f;e++)pykQuery.query[h[e]].config.propagated||g.propogate_filter||pykQuery.query[h[e]].query.exec(null,null,!0)};PykQuery=function(){var a=["sum","count","min","max","avg","std","std_pop","variance_pop","variance","count_distinct","values"],b=["inbrowser","googlequery","postgresql","odbc","mysql","mssql","sqlite","redshift"],c=["between","notBetween","equal","notEqual","greaterThan","greaterThanEqual","lessThan","lessThanEqual","like","in","notIn","isNull","isNotNull","iLike","notILike"],d=function(a,d,e){var f,g={};if(!validateDataType(a,"string"))return void error("Table name is not a string");if(b.indexOf(d)===-1)return void error("Please enter a valid adapter for table.");pykQuery.table[a]={adapter:d,data:e,columns:[],rows_to_be_modified:[],status:0,onComplete:[]},g=pykQuery.table[a];var h={insert:function(a){var b={};return b.action="insert",b.data=a,g.rows_to_be_modified.push(b),this},update:function(a){if("googlequery"===g.adapter){var b={};return b.action="update",b.update=a,g.rows_to_be_modified.push(b),this}error("Update table function not supported in this adapter mode: "+g.adapter)},"delete":function(a){if("googlequery"===g.adapter){var b={};return b.action="delete",b.data=a,g.rows_to_be_modified.push(b),this}error("Delete table function not supported in this adapter mode: "+g.adapter)},deleteTable:function(){if("inbrowser"===g.adapter){var b=Object.keys(pykQuery.table);if(b.indexOf(a)<0)return void error("Table "+name+" doesn't exist");delete pykQuery.table[a]}else error("Delete table function not supported in this adapter mode: "+g.adapter)},dataImpactedBy:function(b){var c=pykQuery.query[b].config;return Object.keys(pykQuery.query).indexOf(b)<0?warning("The query - "+b+" doesn't exist, so it won't be impacted"):(c=pykQuery.query[b].config,c.data_impact_array=c.data_impact_array||[],c.data_impact_array.push(a)),this},exec:function(){if(Object.keys(g).length)return e=tableProcessor(a)},where:function(b,d,e,f){var h={};return g.rows_to_be_filtered=g.rows_to_be_filtered||[],f&&"and"!==f&&"or"!==f&&(f=void 0,error("Value should be one of [and, or] for query "+query_name)),h.conjunction=f||"",h.column_name=b,h.value=e,c.indexOf(d)!==-1?h.condition=d:(error("Invalid WHERE clause condition for query "+a),pykQuery.table[a]={}),g.rows_to_be_filtered.push(h),this}};if("inbrowser"===d)g.columns=Object.keys(e[0]||[]),pykQuery.table[a].status=2;else if("googlequery"===d){var i="https://docs.google.com/spreadsheets/d/";i+=e.key,i+="/gviz/tq?gid="+e.sheetId;var j=setInterval(function(){if(pykQuery.gql_loaded){clearInterval(j);var b=new google.visualization.Query(i);b.setQuery("select * limit 1"),b.send(function(b){if(b.isError())error("Error in query: "+b.getMessage()+" "+b.getDetailedMessage()),e.errorCallBack&&e.errorCallBack(b);else{gql.setHeaders(b),pykQuery.table[a].status=2;var c,d=pykQuery.table[a].onComplete,f=d.length;for(c=0;c<f;c++)d[c].func.apply(d[c].func,d[c].params)}},function(a){a("Error occured in sending request"),e.errorCallBack&&e.errorCallBack()}),pykQuery.gql_current_table=a}},100)}else"postgresql"===d?validatePostgresConnectionParams(e)&&(e.isWeb?(f={connectionParams:e,query:'select * from "'+(pykQuery.table[a].data.schema_name?pykQuery.table[a].data.schema_name+'"."':"")+a+'" limit 1'},sql_query_and_connection_utility.testConnectionOnWebAPIDB(e,f,a)):sql_query_and_connection_utility.testConnectionOnNodeDB(e,a,'select * from "'+(pykQuery.table[a].data.schema_name?pykQuery.table[a].data.schema_name+'"."':"")+a+'" limit 1')):"redshift"===d?validateRedshiftConnectionParams(e)&&(e.isWeb?(f={connectionParams:e,query:'select * from "'+(pykQuery.table[a].data.schema_name?pykQuery.table[a].data.schema_name+'"."':"")+a+'" limit 1'},sql_query_and_connection_utility.testConnectionOnWebAPIDB(e,f,a)):sql_query_and_connection_utility.testConnectionOnNodeDB(e,a,'select * from "'+(pykQuery.table[a].data.schema_name?pykQuery.table[a].data.schema_name+'"."':"")+a+'" limit 1')):"mysql"===d?validateMysqlConnectionParams(e)&&(e.isWeb?(f={connectionParams:e,query:"select * from `"+(pykQuery.table[a].data.schema_name?pykQuery.table[a].data.schema_name+"`.`":"")+a+"` limit 1"},sql_query_and_connection_utility.testConnectionOnWebAPIDB(e,f,a)):sql_query_and_connection_utility.testConnectionOnNodeDB(e,a,"select * from `"+(pykQuery.table[a].data.schema_name?pykQuery.table[a].data.schema_name+"`.`":"")+a+"` limit 1")):"odbc"===d?validateODBCConnectionParams(e)&&(e.isWeb?(f={connectionParams:e,query:'select * from "'+a+'" limit 1'},sql_query_and_connection_utility.testConnectionOnWebAPIDB(e,f,a)):sql_query_and_connection_utility.testConnectionOnNodeDB(e,a,'select * from "'+a+'" limit 1')):"mssql"===d?validateMssqlConnectionParams(e)&&(e.isWeb?(f={connectionParams:e,query:"select top 1 * from ["+(pykQuery.table[a].data.schema_name?pykQuery.table[a].data.schema_name+"].[":"")+a+"]"},sql_query_and_connection_utility.testConnectionOnWebAPIDB(e,f,a)):sql_query_and_connection_utility.testConnectionOnNodeDB(e,a,"select top 1 * from ["+(pykQuery.table[a].data.schema_name?pykQuery.table[a].data.schema_name+"].[":"")+a+"]")):"sqlite"===d&&validateSqliteConnectionParams(e)&&(e.isWeb?(f={connectionParams:e,query:'select * from "'+a+'" limit 1'},sql_query_and_connection_utility.testConnectionOnWebAPIDB(e,f,a)):sql_query_and_connection_utility.testConnectionOnNodeDB(e,a,'select * from "'+a+'" limit 1'));return h},e=function(b){function d(){return{conjunction:"",column_name:[]}}function e(a){var c,d,e,f=a.length,g=0,h=pykQuery.query[b].config.join_columns,i=pykQuery.query[b].config.join_columns.length,j=0,k=[];if("*"===a[0].name){for(g=-1;++g<i;)c={},c.name=h[g].new_name,c.alias=h[g].original_name,k.push(c);pykQuery.query[b].config.dim=k}else for(g=-1;++g<f;){for(d=!1,j=-1;++j<i;)a[g].name===h[j].original_name&&d===!1?(e=h[j].new_name,d=!0):a[g].name===h[j].original_name&&d===!0&&(pykQuery.query[b].config={},error("Ambigious column name "+a[g].name));d&&(a[g].name=e)}}function f(a){var c,d,e=a.length,f=0,g=pykQuery.query[b].config.join_columns,h=pykQuery.query[b].config.join_columns.length,i=0;for(f=-1;++f<e;){for(c=!1,i=-1;++i<h;)a[f].name===g[i].original_name&&c===!1?(d=g[i].new_name,c=!0):a[f].name===g[i].original_name&&c===!0&&(pykQuery.query[b].config={},error("Ambigious column name "+a[f].name));c&&(a[f].name=d)}}function g(a){var c,d,e=a.length,f=0,g=pykQuery.query[b].config.join_columns,h=pykQuery.query[b].config.join_columns.length,i=0;for(f=-1;++f<e;){for(c=!1,i=-1;++i<h;)a[f]===g[i].original_name&&c===!1?(d=g[i].new_name,c=!0):a[f]===g[i].original_name&&c===!0&&(pykQuery.query[b].config={},error("Ambigious column name "+a[f]));c&&(a[f]=d)}}function h(a){var c,d,e=a.length,f=0,g=pykQuery.query[b].config.join_columns,h=pykQuery.query[b].config.join_columns.length,i=0;for(f=-1;++f<e;){for(c=!1,i=-1;++i<h;)a[f]===g[i].original_name&&c===!1?(d=g[i].new_name,c=!0):a[f]===g[i].original_name&&c===!0&&(pykQuery.query[b].config={},error("Ambigious column name "+a[f]));c&&(a[f]=d)}}function i(a){var c,d,e=a.length,f=0,g=pykQuery.query[b].config.join_columns,h=pykQuery.query[b].config.join_columns.length,i=0;for(f=-1;++f<e;){for(c=!1,i=-1;++i<h;)a[f].column_name===g[i].original_name&&c===!1?(d=g[i].new_name,c=!0):a[f].column_name===g[i].original_name&&c===!0&&(pykQuery.query[b].config={},error("Ambigious column name "+a[f].column_name));c&&(a[f].column_name=d)}}function j(a){var c,d,e,f,g,h=a.length,i=0,j={},k=[];for(pykQuery.query[b].config.join_columns=[],f=pykQuery.query[b].config.join_columns,i=-1;++i<h;)for(d=a[i].name,g=pykQuery.escapeLiterals[pykQuery.table[d].adapter],k=pykQuery.table[d].columns,e=k.length,c=-1;++c<e;)j={},j.original_name=k[c],j.new_name=g+d+g+"."+g+k[c]+g,f.push(j)}pykQuery.query[b]={config:{}};var k={select:function(){var a,c,d,e,f,g=pykQuery.query[b].config,h=arguments.length,i=1;if(g.dim=[],0===h)g.dim[0]={name:"*"};else for(f=-1;++f<h;)"string"==typeof arguments[f]?(e=arguments[f].split(";"),d=e[0].split(" AS "),2===d.length?2===e.length?g.dim.push({name:d[0],alias:d[1],use_quotes:!1}):g.dim.push({name:d[0],alias:d[1],use_quotes:!0}):2===e.length?g.dim.push({name:e[0],alias:e[0],use_quotes:!1}):g.dim.push({name:e[0],alias:e[0],use_quotes:!0})):"function"==typeof arguments[f]?(g.dim.push({name:arguments[f],alias:"customColumn"+i}),i++):"object"==typeof arguments[f]&&(a=Object.keys(arguments[f])[0],c=arguments[f][a],"function"==typeof c?g.dim.push({name:c,alias:a}):(warning("In case of object the key should be column name and the value should be a function"),pykQuery.query[b].config={}));return this},getConfig:function(){return pykQuery.query[b].config},setConfig:function(a){pykQuery.query[b].config=a},group:function(){var c,d,e,f,g,h=pykQuery.query[b].config,i=arguments.length;for(h.met=h.met||[],h.lastGroupId=h.lastGroupId||0,h.lastGroupId++,this.process_id=h.lastGroupId,c=-1;++c<i;)"function"==typeof arguments[c]?(h.met.push({name:arguments[c],aggr:"custom",alias:"customAggregation"+custom_aggregation}),custom_aggregation++,h.met[h.met.length-1].id=h.lastGroupId):"object"==typeof arguments[c]?(d=Object.keys(arguments[c]),e=arguments[c][d],d.length>1?(h.met.push(arguments[c]),h.met[h.met.length-1].id=h.lastGroupId):"function"==typeof e?(h.met.push({name:e,aggr:"custom",alias:d}),h.met[h.met.length-1].id=h.lastGroupId):"string"==typeof e?a.indexOf(e)===-1?warning("The value should be one of the supported aggregation functions"):(g=d[0].split(" AS "),f=d[0].split(";"),g=f[0].split(" AS "),2===g.length?2===f.length?h.met.push({name:g[0],aggr:e,alias:g[1],use_quotes:!1}):h.met.push({name:g[0],aggr:e,alias:g[1],use_quotes:!0}):2===f.length?h.met.push({name:g[0],aggr:e,alias:e+" "+g[0],use_quotes:!1}):h.met.push({name:g[0],aggr:e,alias:e+" "+g[0],use_quotes:!0}),h.met[h.met.length-1].id=h.lastGroupId):(warning("group accepts functions or objects with either key as alias name and value as functions or key as column name with value as name of aggregation function"),pykQuery.query[b].config={})):(warning("group accepts functions or objects with key as alias name and value as functions"),pykQuery.query[b].config={});return this},distinct:function(){var a=pykQuery.query[b].config;return a.dim=[],a.distinct=!0,this.select.apply(this,arguments),this},groupBy:function(){var a,c=pykQuery.query[b].config,d=c.dim,e=d?d.length:0,f=arguments.length;for(c.groupby=[],a=-1;++a<e;)"string"==typeof d[a].name?c.groupby.push(d[a].name+(d[a].use_quotes?"":"; ")):c.groupby.push(d[a].name);for(a=-1;++a<f;)"string"==typeof arguments[a]?c.groupby.push(arguments[a]):"number"==typeof arguments[a]?f<=e&&arguments[a]-1<e&&arguments[a]-1>=0?c.groupby.push(d[arguments[a]-1].name):error("groupby parameter doesnot  match with select parameter"):(error("groupby accepts column names as string or number"),pykQuery.query[b].config={});return this},where:function(a,d,e,f){var g,h,i,j,k,l,m=pykQuery.query[b].config,n={};return m.where=m.where||[],m.lastWhereId=m.lastWhereId||0,m.lastWhereId++,this.process_id=m.lastWhereId,f&&"and"!==f&&"or"!==f&&(f=void 0,error("Value should be one of [and, or] for query "+b),pykQuery.query[b].config={}),validateDataType(a,"function")?(n.conjunction=f||"",n.value=a,m.where.push(n),m.where[m.where.length-1].id=m.lastWhereId):pykQuery.nested_where_mode?(c.indexOf(d)!==-1?g=d:(error("Invalid WHERE clause condition for query "+b),pykQuery.query[b].config={}),h={conjunction:f||"",column_name:a,value:e,condition:g},i=pykQuery.push_to,j=i.length,k=i[j-1],h.id=m.lastWhereId,k.push(h)):(n.conjunction=f||"",l="string"==typeof a?a.split(";"):a,2===l.length?n.use_quotes=!1:n.use_quotes=!0,n.column_name=a,n.value=e,c.indexOf(d)!==-1?n.condition=d:(error("Invalid WHERE clause condition for query "+b),pykQuery.query[b].config={}),m.where.push(n),m.where[m.where.length-1].id=m.lastWhereId),this},nestedWhere:function(a,c){var e,f,g,h=pykQuery.query[b].config,i=d();return h.where=h.where||[],c&&"and"!==c&&"or"!==c&&(c=void 0,error("Value should be one of [and, or] for query "+b),pykQuery.query[b].config={}),i.conjunction=c||"",pykQuery.push_to.push(i.column_name),pykQuery.nested_where_mode=!0,a.call(this),pykQuery.push_to.pop(),0!==pykQuery.push_to.length&&(e=pykQuery.push_to,f=e.length,g=e[f-1],g.push(i)),0===pykQuery.push_to.length&&(pykQuery.nested_where_mode=!1,h.where.push(i),h.lastWhereId=h.lastWhereId||0,h.lastWhereId++,this.process_id=h.lastWhereId,h.where[h.where.length-1].id=h.lastWhereId),this},from:function(a){var c,d,e,f=(arguments[0],pykQuery.query[b].config),g=arguments[1];return f.table=f.table||[],"string"==typeof a?(c=a.split(" AS "),d=c.length,f.table.push({name:c[0],alias:d>1?c[1]:c[0],join_type:g,schema_name:pykQuery.table[c[0]].data.schema_name,tableId:arguments[2]}),e=c[0]):warning("From accepts table name as string"),pykQuery.table[e]||(error("Table "+e+" doesn't exist"),pykQuery.query[b].config={}),this},limit:function(a){var c=pykQuery.query[b].config;return validateDataType(a,"number")||(warning("Limit value"+a+" is not a number"),a=""),c.limit=a,this},offset:function(a){var c=pykQuery.query[b].config;return validateDataType(a,"number")||(warning("Offset value"+a+" is not a number"),a=""),c.offset=a,this},"delete":function(){delete pykQuery.query[b]},having:function(a,d,e,f){var g,h,i,j,k,l,m,n=pykQuery.query[b].config,o=!1,p={};if(n.having=n.having||[],f&&"and"!==f&&"or"!==f&&(f=void 0,error("Value should be one of [and, or] for query "+b),pykQuery.query[b].config={}),validateDataType(a,"function"))p.conjunction=f||"",n.aggregation=n.aggregation||[],m=n.aggregation.length,0===m?(n.aggregation.push({name:a,aggr:"custom",alias:"extraAggretation_1"}),p.column_name="extraAggretation_1"):(p.column_name="extraAggretation_"+(+n.aggregation[m-1].alias.split("_")[1]+1),n.aggregation.push({name:a,aggr:"custom",alias:p.column_name})),p.condition="equal",p.value=!0,n.having.push(p);else if(validateDataType(a,"object")){for(p.conjunction=f||"",p.column_name=Object.keys(a)[0],p.value=a[p.column_name],n.aggregation=n.aggregation||[],g=-1;++g<n.met.length;)p.column_name!==n.met[g].name&&p.column_name!==n.met[g].alias||p.value.toString()!==n.met[g].name.toString()&&p.value.toString()!==n.met[g].aggr||(o=!0);o?(p.actual_column_name=JSON.parse(JSON.stringify(a)),p.column_name=n.met[g-1].alias,p.condition=d,p.value=e,n.having.push(p)):(m=n.aggregation.length,0===m?n.aggregation.push({name:p.column_name,aggr:p.value,alias:"extraAggretation_1"}):n.aggregation.push({name:p.column_name,aggr:p.value,alias:"extraAggretation_"+(+n.aggregation[m-1].alias.split("_")[1]+1)}),p.actual_column_name=JSON.parse(JSON.stringify(a)),p.column_name=n.aggregation[n.aggregation.length-1].alias,p.condition=d,p.value=e,n.having.push(p))}else pykQuery.nested_having_mode?(c.indexOf(d)!==-1?h=d:(error("Invalid HAVING clause condition for query "+b),pykQuery.query[b].config={}),i={conjunction:f||"",column_name:a,value:e,condition:h},j=pykQuery.push_to,k=j.length,l=j[k-1],l.push(i)):(p.conjunction=f||"",p.column_name=a,p.value=e,c.indexOf(d)!==-1?p.condition=d:(error("Invalid HAVING clause condition for query "+b),pykQuery.query[b].config={}),n.having.push(p));return this},nestedHaving:function(a,c){var e,f,g,h=pykQuery.query[b].config,i=d();return c&&"and"!==c&&"or"!==c&&(c=void 0,error("Value should be one of [and, or] for query "+b),pykQuery.query[b].config={}),i.conjunction=c||"",pykQuery.push_to.push(i.column_name),pykQuery.nested_having_mode=!0,a.call(this),pykQuery.push_to.pop(),0!==pykQuery.push_to.length&&(e=pykQuery.push_to,g=e.length,f=e[g-1],f.push(i)),0===pykQuery.push_to.length&&(pykQuery.nested_having_mode=!1,h.having.push(i)),this},orderBy:function(){var a,c,d,e,f,g,h,i,j=arguments.length,k=pykQuery.query[b].config,l=k.table[0].name,m=(pykQuery.table[l].columns,k.dim?k.dim.filter(function(a){return a.alias}):[],k.met?k.met.filter(function(a){return a.alias}):[],k.dim);for(k.order_by=[],i=-1;++i<j;)g={},a=arguments[i],validateDataType(a,"string")?(a.indexOf(";")!==-1&&2===a.split(";").length?(a=a.split(";")[0],g.use_quotes=!1):g.use_quotes=!0,a.indexOf(",asc")>-1||a.indexOf(",desc")>-1?(h=a.lastIndexOf(","),c=[a.substring(0,h),a.substring(h+1)],d=c.length,e=c[0],f=c[1].toLowerCase(),f="asc"===f||"desc"===f?f:"asc"):(e=a,f="asc"),g.column_name=e,g.sort_type=f,k.order_by.push(g)):validateDataType(a,"number")?j<=m.length&&a-1<m.length&&a-1>=0?(f="asc",g.column_name=m[a-1].name,g.sort_type=f,k.order_by.push(g)):console.error("For orderBy the column name should be a string or (number by parameter). Hence, "+a+" is invalid."):console.error("For orderBy the column name should be a string or number. Hence, "+a+" is invalid.");return this},exec:function(a,c,d){var k,l,m,n=pykQuery.query[b].config,o=0,p=!0;if(d)n.propogate_filter=!0;else{for(l=Object.keys(pykQuery.query),m=l.length,q=0;q<m;q++)pykQuery.query[l[q]].config.propagated=!1;n.propogate_filter=!1}if(Object.keys(n).length<1)return error("The query "+b+" is blank"),void(callback_oneror&&callback_oneror("The query "+b+" is blank"));if(n.groupby)if(n.dim&&n.dim.length>0||n.met&&n.met.length>0)"inbrowser"!==pykQuery.table[n.table[0].name].adapter&&n.dim&&n.dim.length!==n.groupby.length&&(warning("Both dimension and metric should be present together for groupby"),pykQuery.query[b].config={});else{for(q=0;q<n.met.length;q++)"values"===n.met[q].aggr&&o++,o===n.met.length&&(p=!1);p&&(warning("Both dimension and metric should be present together for groupby"),pykQuery.query[b].config={})}else if(void 0===n.groupby)if(n.dim&&0!==n.dim.length&&n.met&&0!==n.met.length){for(q=0;q<n.met.length;q++)"values"===n.met[q].aggr&&o++,o===n.met.length&&(p=!1);p&&(warning("Both dimension and metric cannot work together without groupby"),pykQuery.query[b].config={})}else n.having&&(warning("HAVING clause cannot work without groupby"),pykQuery.query[b].config={});if(n.table.length>1&&(!n.on||0===n.on.length)&&(warning("JOIN clause cannot work without on.Please specify the condition by which JOIN is to performed"),pykQuery.query[b].config={}),Object.keys(pykQuery.query[b].config).length){var q,r=!0;for(q=0;q<n.table.length;q++)pykQuery.table[n.table[q].name].status<2&&(r=!1);if(r)n.table.length>1&&(j(n.table),n.dim&&e(n.dim),n.met&&f(n.met),n.groupby&&g(n.groupby),n.where&&i(n.where),n.aggregation&&h(n.aggregation)),k=queryProcessor(n.table[0].name,b,a,c);else for(q=0;q<n.table.length;q++)this.exec&&pykQuery.table[n.table[q].name].onComplete.push({func:this.exec,params:[a,c]});return k}},filterImpacts:function(a,c){var d,e={};return validateDataType(a,"string")?c&&!validateDataType(c,"boolean")?console.error("The inter_impact flag should be a boolean. Hence, "+c+" is invalid."):Object.keys(pykQuery.query).indexOf(a)<0?warning("The query - "+a+" doesn't exist, so it won't be impacted"):(e=pykQuery.query[b].config,d=pykQuery.query[a].config,e.filter_impact_array=e.filter_impact_array||[],e.filter_impact_array.push(a),d.filter_impacted_by_array=d.filter_impacted_by_array||[],d.filter_impacted_by_array.push(b),c&&(d.filter_impact_array=d.filter_impact_array||[],d.filter_impact_array.push(b),e.filter_impacted_by_array=e.filter_impacted_by_array||[],e.filter_impacted_by_array.push(a))):console.error("The impact_query_name should be a string. Hence, "+a+" is invalid."),this},filterImpactedBy:function(a,c){var d,e={};return validateDataType(a,"string")?c&&!validateDataType(c,"boolean")?console.error("The inter_impact flag should be a boolean. Hence, "+c+" is invalid."):Object.keys(pykQuery.query).indexOf(a)<0?warning("The query - "+a+" doesn't exist, so it won't be impacted"):(d=pykQuery.query[a].config,e=pykQuery.query[b].config,d.filter_impact_array=d.filter_impact_array||[],d.filter_impact_array.push(b),e.filter_impacted_by_array=e.filter_impacted_by_array||[],e.filter_impacted_by_array.push(a),c&&(e.filter_impact_array=e.filter_impact_array||[],e.filter_impact_array.push(a),d.filter_impacted_by_array=d.filter_impacted_by_array||[],d.filter_impacted_by_array.push(b))):console.error("The impactedby_query_name should be a string. Hence, "+a+" is invalid."),this},dataImpacts:function(a){var c=pykQuery.query[b].config;return Object.keys(pykQuery.table).indexOf(a)<0?warning("The table - "+a+" doesn't exist, so it won't be impacted"):(c=pykQuery.query[b].config,c.data_impact_array=c.data_impact_array||[],c.data_impact_array.push(a)),this},fullouterjoin:function(a){var c=pykQuery.query[b].config,d={},e={};c.joinId=c.joinId||0,c.joinId++,[].push.call(arguments,"full"),[].push.call(arguments,c.joinId),d=this.from.apply(this,arguments),e=c.table},leftjoin:function(){var a=pykQuery.query[b].config,c={},d={};return a.joinId=a.joinId||0,a.joinId++,[].push.call(arguments,"left"),[].push.call(arguments,a.joinId),c=this.from.apply(this,arguments),d=a.table,this},rightjoin:function(){var a=pykQuery.query[b].config,c={},d={};return a.joinId=a.joinId||0,a.joinId++,[].push.call(arguments,"right"),[].push.call(arguments,a.joinId),c=this.from.apply(this,arguments),d=a.table,this},innerjoin:function(){var a=pykQuery.query[b].config,c={},d={};return a.joinId=a.joinId||0,a.joinId++,[].push.call(arguments,"inner"),[].push.call(arguments,a.joinId),c=this.from.apply(this,arguments),d=a.table,this},on:function(a,d,e,f){var g,h,i=pykQuery.query[b].config;if(i.on=i.on||[],i.lastOnId=i.lastOnId||0,i.lastOnId++,this.process_id=i.lastOnId,f&&["and","or"].indexOf(f)===-1&&(f=void 0,i={}),validateDataType(a,"function"))g={},g.conjunction=f||"",g.value=a,i.on.push(g),i.on[i.on.length-1].id=i.lastOnId,i.on[i.on.length-1].tableId=i.joinId;else if(pykQuery.nested_on_mode){var j;c.indexOf(d)!==-1?j=d:(console.error("Invalid ON clause condition for query "+b),i={});var k={conjunction:f||"",column_name:a,value:e,condition:d},l=pykQuery.push_to,m=l.length,n=l[m-1];k.id=i.lastOnId,n.push(k)}else g={},g.conjunction=f||"",h="string"==typeof a?a.split(";"):a,2===h.length?g.use_quotes=!1:g.use_quotes=!0,g.column_name=a,g.value=e,c.indexOf(d)!==-1?g.condition=d:(console.error("Invalid on clause condition for query "+b),i={}),i.on.push(g),i.on[i.on.length-1].id=i.lastOnId,i.on[i.on.length-1].tableId=i.joinId;return this},nestedOn:function(a,c){var e=pykQuery.query[b].config,f=d();if(e.on=e.on||[],c&&["and","or"].indexOf(c)===-1&&(c=void 0,console.error("Value should be one of [and, or] for query "+b),e={}),f.conjunction=c||"",
pykQuery.push_to.push(f.column_name),pykQuery.nested_on_mode=!0,a.call(this),pykQuery.push_to.pop(),0!==pykQuery.push_to.length){var g=pykQuery.push_to,h=g.length,i=g[h-1];i.push(f)}return 0===pykQuery.push_to.length&&(pykQuery.nested_where_mode=!1,e.on.push(f),e.lastOnId=e.lastOnId||0,e.lastOnId++,this.process_id=e.lastOnId,e.on[e.on.length-1].id=e.lastOnId),this},union:function(a){var c=pykQuery.query[b].config,d={};return validateDataType(a,"string")?pykQuery.query[a]?(c.union_unionall_intersection=c.union_unionall_intersection||[],d={type:"union",query:a},c.union_unionall_intersection.push(d)):(error("No such query exists "+a),c={}):(error("Union query name should be a string "),c={}),this},unionall:function(a){var c=pykQuery.query[b].config,d={};return validateDataType(a,"string")?pykQuery.query[a]?(c.union_unionall_intersection=c.union_unionall_intersection||[],d={type:"unionall",query:a},c.union_unionall_intersection.push(d)):(error("No such query exists "+a),c={}):(error("Union all query name should be a string "),c={}),this},intersection:function(a){var c=pykQuery.query[b].config,d={};return validateDataType(a,"string")?pykQuery.query[a]?(c.union_unionall_intersection=c.union_unionall_intersection||[],d={type:"intersection",query:a},c.union_unionall_intersection.push(d)):(error("No such query exists "+a),c={}):(error("Union all query name should be a string "),c={}),this},reset:function(){pykQuery.query[b].config={}},process_id:"",remove:function(a,c){function d(a,b){if(a){for(var c=0;c<a.length;c++){if(a[c].id===b){a.splice(c,1);break}a[c].column_name instanceof Array&&d(a[c].column_name,b)}0===f.where.length&&delete f.where}else console.log("The filter object is empty and hence no filters to remove")}function e(a,b){for(var c=0;c<a.length;c++){if(a[c].id===b){f.table&&(f.table=f.table.filter(function(b){return b.tableId!==a[c].tableId})),a.splice(c,1);break}a[c].column_name instanceof Array&&e(a[c].column_name,b)}}var f=pykQuery.query[b].config;switch(a){case"where":switch(c){case"all":delete f.where;break;default:d(f.where,c)}break;case"group":switch(c){case"all":f.met=[];break;default:for(var g=0;g<f.met.length;g++)if(f.met[g].id===c){f.met.splice(g,1);break}}break;case"on":switch(c){case"all":f.on=[],f.table=f.table.filter(function(a){return!a.join_type});break;default:e(f.on,c)}break;case"groupby":switch(c){case"all":delete f.groupby}}return this},update:function(a,c){function d(a,b){for(var c=0;c<a.length;c++){if(a[c].id===b){a[c].column_name="$pyklock$"===g[0]?a[c].column_name:g[0],a[c].condition="$pyklock$"===g[1]?a[c].condition:g[1],a[c].value="$pyklock$"===g[2]?a[c].value:g[2],a[c].conjunction="$pyklock$"===g[3]?a[c].conjunction:g[3];break}a[c].column_name instanceof Array&&d(a[c].column_name,b)}}function e(a,b){for(var c=0;c<a.length;c++){if(a[c].id===b){a[c].column_name="$pyklock$"===g[0]?a[c].column_name:g[0],a[c].condition="$pyklock$"===g[1]?a[c].condition:g[1],a[c].value="$pyklock$"===g[2]?a[c].value:g[2],a[c].conjunction="$pyklock$"===g[3]?a[c].conjunction:g[3];break}a[c].column_name instanceof Array&&e(a[c].column_name,b)}}var f=Array.prototype.slice.call(arguments),g=f.slice(2,f.length),h=pykQuery.query[b].config;switch(a){case"where":d(h.where,c);break;case"group":for(var i=0;i<h.met.length;i++)if(h.met[i].id===c){h.met[i]=g[0];break}break;case"on":e(h.on,c)}return this},after:function(a,c){var d=pykQuery.query[b].config;switch(a){case"impact":d.after=d.after||{},d.after.impact=c}return this}};return pykQuery.query[b].query=k,k},f=function(a){return pykQuery.userAccessDetails=pykQuery.userAccessDetails||{},g(a),window.setInterval(function(){g(a)},36e5),!0},g=function(a){var b={client_id:a.client_id,client_secret:a.client_secret,refresh_token:a.refresh_token,grant_type:"refresh_token"},c=jsonToUrl(b);pykQuery.userAccessDetails={client_id:b.client_id,client_secret:b.client_secret,refresh_token:b.refresh_token,grant_type:"refresh_token"},sendHTTPRequest({action:"POST",url:"https://www.googleapis.com/oauth2/v4/token",headers:{"Content-type":"application/x-www-form-urlencoded"},request:c,success:function(a){var b=JSON.parse(a);pykQuery.userAccessDetails.access_token=b.access_token,pykQuery.userAccessDetails.token_type=b.token_type,pykQuery.userAccessDetails.expires_in=b.expires_in},error:function(a){console.error("Error occured in fetching authentication details")},async:!1})},h=document.createElement("script");return h.onload=function(){google.charts.load("current",{packages:["table"]}),google.charts.setOnLoadCallback(function(){pykQuery.gql_loaded=!0})},h.src="https://www.gstatic.com/charts/loader.js",document&&document.getElementsByTagName("head")[0].appendChild(h),{createTable:d,createQuery:e,grantAccess:f}}(),"function"==typeof require&&(module.exports.PykQuery=PykQuery);